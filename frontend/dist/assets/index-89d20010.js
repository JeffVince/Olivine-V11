import{v as se,a5 as a,a7 as f,a8 as R,a9 as e,E as P,A as t,_ as n,W as p,u as c,ae as q,B as Re,ac as L,ad as W,F as Q,r as G,w as ae,aj as ze,c as T,k as De,ab as he,a as me}from"./vue-b3dbcb9b.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";import{g as Y,u as et,h as te,j as tt}from"./apollo-9599811a.js";import{b as lt,a as ot}from"./index-c29b4afb.js";import"./supabase-cf010ec4.js";function ve(){const k=[{title:"Name",key:"name",sortable:!0},{title:"MIME",key:"mimeType",sortable:!0},{title:"Size",key:"size",sortable:!0},{title:"Updated",key:"updatedAt",sortable:!0},{title:"",key:"actions",sortable:!1}],_=[{key:"current",label:"Current",icon:"mdi-check-circle"},{key:"deleted",label:"Deleted",icon:"mdi-delete"}],C=[{value:"PENDING",label:"Pending"},{value:"CLASSIFIED",label:"Classified"},{value:"MANUAL_REVIEW",label:"Manual review"},{value:"FAILED",label:"Failed"}],$=[{value:"application/pdf",label:"PDF"},{value:"image/jpeg",label:"JPEG"},{value:"image/png",label:"PNG"},{value:"text/plain",label:"Text"},{value:"application/json",label:"JSON"}];function b(d){switch(d.toLowerCase()){case"dropbox":return"blue";case"googledrive":return"green";default:return"grey"}}function z(d){switch(d.toLowerCase()){case"dropbox":return"mdi-dropbox";case"googledrive":return"mdi-google-drive";default:return"mdi-cloud"}}function V(d){const i=["Bytes","KB","MB","GB"];if(d===0)return"0 Bytes";const o=Math.floor(Math.log(d)/Math.log(1024));return Math.round(d/Math.pow(1024,o)*100)/100+" "+i[o]}function I(d){return new Date(d).toLocaleDateString()}function g(d){switch((d||"").toUpperCase()){case"CLASSIFIED":return"green";case"MANUAL_REVIEW":return"orange";case"FAILED":return"red";default:return"grey"}}function r(d){return d?d.startsWith("image/")?"mdi-file-image":d.startsWith("video/")?"mdi-file-video":d.startsWith("audio/")?"mdi-file-music":d==="application/pdf"?"mdi-file-pdf-box":d.startsWith("text/")?"mdi-file-document":"mdi-file":"mdi-file"}return{fileHeaders:k,fileFilters:_,classificationOptions:C,mimeOptions:$,getProviderColor:b,getProviderIcon:z,formatFileSize:V,formatDate:I,classificationColor:g,mimeIcon:r}}const nt={class:"d-flex align-center"},it=se({__name:"FileTable",props:{filteredFiles:{},loading:{type:Boolean},renameFile:{},moveFile:{},downloadFile:{},openInProvider:{}},emits:["fileSelect"],setup(k,{emit:_}){const C=_,{fileHeaders:$,formatFileSize:b,formatDate:z,mimeIcon:V}=ve();function I(d,{item:i}){C("fileSelect",i)}function g(d,i){const o=window.prompt("Rename file",d.name);o&&o!==d.name&&i(d.id,o)}function r(d,i){const o=window.prompt("Move file to path",d.path);o&&o!==d.path&&i(d.id,o)}return(d,i)=>{const o=a("v-icon"),S=a("v-chip"),x=a("v-btn"),s=a("v-list-item-title"),v=a("v-list-item"),F=a("v-list"),A=a("v-menu"),y=a("v-data-table");return f(),R(y,{headers:c($),items:d.filteredFiles,loading:d.loading,density:"compact",class:"elevation-1","onClick:row":I},{"item.name":e(({item:w})=>[P("div",nt,[t(o,{size:"small",class:"mr-2"},{default:e(()=>[n(p(c(V)(w.mimeType)),1)]),_:2},1024),P("span",null,p(w.name),1)])]),"item.mimeType":e(({item:w})=>[w.mimeType?(f(),R(S,{key:0,size:"x-small",variant:"tonal"},{default:e(()=>[n(p(w.mimeType),1)]),_:2},1024)):q("",!0)]),"item.size":e(({item:w})=>[n(p(c(b)(w.size||0)),1)]),"item.updatedAt":e(({item:w})=>[n(p(c(z)(w.updatedAt||"")),1)]),"item.actions":e(({item:w})=>[t(A,null,{activator:e(({props:D})=>[t(x,Re({icon:"",variant:"text",size:"small"},D),{default:e(()=>[t(o,null,{default:e(()=>i[0]||(i[0]=[n("mdi-dots-vertical",-1)])),_:1,__:[0]})]),_:2},1040)]),default:e(()=>[t(F,{density:"compact"},{default:e(()=>[t(v,{onClick:D=>g(w,d.renameFile)},{prepend:e(()=>[t(o,null,{default:e(()=>i[1]||(i[1]=[n("mdi-pencil",-1)])),_:1,__:[1]})]),default:e(()=>[t(s,null,{default:e(()=>i[2]||(i[2]=[n("Rename",-1)])),_:1,__:[2]})]),_:2},1032,["onClick"]),t(v,{onClick:D=>r(w,d.moveFile)},{prepend:e(()=>[t(o,null,{default:e(()=>i[3]||(i[3]=[n("mdi-folder-move",-1)])),_:1,__:[3]})]),default:e(()=>[t(s,null,{default:e(()=>i[4]||(i[4]=[n("Move",-1)])),_:1,__:[4]})]),_:2},1032,["onClick"]),t(v,{onClick:D=>d.downloadFile(w.id)},{prepend:e(()=>[t(o,null,{default:e(()=>i[5]||(i[5]=[n("mdi-download",-1)])),_:1,__:[5]})]),default:e(()=>[t(s,null,{default:e(()=>i[6]||(i[6]=[n("Download",-1)])),_:1,__:[6]})]),_:2},1032,["onClick"]),t(v,{onClick:D=>d.openInProvider(w.id)},{prepend:e(()=>[t(o,null,{default:e(()=>i[7]||(i[7]=[n("mdi-open-in-new",-1)])),_:1,__:[7]})]),default:e(()=>[t(s,null,{default:e(()=>i[8]||(i[8]=[n("Open in Provider",-1)])),_:1,__:[8]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["headers","items","loading"])}}});const at=fe(it,[["__scopeId","data-v-a54bdd61"]]),st={class:"text-subtitle-2 mb-2"},dt={key:0,class:"ml-2 text-medium-emphasis"},rt={class:"mt-4 d-flex gap-2"},ut={class:"text-left"},ct=se({__name:"FileInspector",props:{selectedFile:{},actionLoading:{type:Boolean},showClassify:{type:Boolean},classificationOptions:{},mimeOptions:{}},emits:["triggerReprocess","showClassify","applyClassificationFilter","applyMimeFilter"],setup(k,{emit:_}){const C=_,{formatFileSize:$,formatDate:b,classificationColor:z,mimeIcon:V}=ve();function I(){C("triggerReprocess")}function g(i){C("showClassify",i)}function r(i){C("applyClassificationFilter",i)}function d(i){C("applyMimeFilter",i)}return(i,o)=>{const S=a("v-icon"),x=a("v-card-title"),s=a("v-list-item-title"),v=a("v-list-item-subtitle"),F=a("v-list-item"),A=a("v-chip"),y=a("v-list"),w=a("v-btn"),D=a("v-card-text"),H=a("v-card"),le=a("v-divider"),X=a("v-list-subheader");return i.selectedFile?(f(),R(H,{key:0,class:"glass-card"},{default:e(()=>[t(x,null,{default:e(()=>[t(S,{class:"mr-2"},{default:e(()=>o[1]||(o[1]=[n(" mdi-information ",-1)])),_:1,__:[1]}),o[2]||(o[2]=n(" Inspector ",-1))]),_:1,__:[2]}),t(D,null,{default:e(()=>{var N,J;return[P("h4",st,p(i.selectedFile.name),1),t(y,{density:"compact"},{default:e(()=>{var Z;return[t(F,null,{default:e(()=>[t(s,null,{default:e(()=>o[3]||(o[3]=[n("Size",-1)])),_:1,__:[3]}),t(v,null,{default:e(()=>[n(p(c($)(i.selectedFile.size||0)),1)]),_:1})]),_:1}),t(F,null,{default:e(()=>[t(s,null,{default:e(()=>o[4]||(o[4]=[n("Updated",-1)])),_:1,__:[4]}),t(v,null,{default:e(()=>[n(p(c(b)(i.selectedFile.updatedAt||"")),1)]),_:1})]),_:1}),t(F,null,{default:e(()=>[t(s,null,{default:e(()=>o[5]||(o[5]=[n("Path",-1)])),_:1,__:[5]}),t(v,{class:"text-wrap"},{default:e(()=>[n(p(i.selectedFile.path),1)]),_:1})]),_:1}),t(F,null,{default:e(()=>[t(s,null,{default:e(()=>o[6]||(o[6]=[n("MIME",-1)])),_:1,__:[6]}),t(v,{class:"text-wrap"},{default:e(()=>[n(p(i.selectedFile.mimeType),1)]),_:1})]),_:1}),(Z=i.selectedFile.metadata)!=null&&Z.preview||i.selectedFile.extractedText?(f(),R(F,{key:0},{default:e(()=>[t(s,null,{default:e(()=>o[7]||(o[7]=[n("Preview",-1)])),_:1,__:[7]}),t(v,{class:"text-wrap",style:{"white-space":"pre-wrap","max-height":"240px",overflow:"auto"}},{default:e(()=>{var de;return[n(p(((de=i.selectedFile.metadata)==null?void 0:de.preview)||i.selectedFile.extractedText),1)]}),_:1})]),_:1})):q("",!0),t(F,null,{default:e(()=>[t(s,null,{default:e(()=>o[8]||(o[8]=[n("Classification",-1)])),_:1,__:[8]}),t(v,null,{default:e(()=>[t(A,{color:c(z)(i.selectedFile.classificationStatus),size:"small",label:"",variant:"tonal"},{default:e(()=>[n(p(i.selectedFile.classificationStatus),1)]),_:1},8,["color"]),i.selectedFile.classificationConfidence?(f(),L("span",dt,p((i.selectedFile.classificationConfidence*100).toFixed(0))+"% ",1)):q("",!0)]),_:1})]),_:1}),i.selectedFile.canonicalSlot?(f(),R(F,{key:1},{default:e(()=>[t(s,null,{default:e(()=>o[9]||(o[9]=[n("Canonical Slot",-1)])),_:1,__:[9]}),t(v,null,{default:e(()=>[n(p(i.selectedFile.canonicalSlot),1)]),_:1})]),_:1})):q("",!0)]}),_:1}),P("div",rt,[t(w,{color:"primary","prepend-icon":"mdi-refresh",loading:i.actionLoading,onClick:I},{default:e(()=>o[10]||(o[10]=[n(" Reprocess ",-1)])),_:1,__:[10]},8,["loading"]),t(w,{color:"secondary","prepend-icon":"mdi-tag",onClick:o[0]||(o[0]=Z=>g=!0)},{default:e(()=>o[11]||(o[11]=[n(" Classify ",-1)])),_:1,__:[11]}),(N=i.selectedFile.metadata)!=null&&N.downloadUrl?(f(),R(w,{key:0,href:i.selectedFile.metadata.downloadUrl,target:"_blank","prepend-icon":"mdi-download"},{default:e(()=>o[12]||(o[12]=[n(" Download ",-1)])),_:1,__:[12]},8,["href"])):q("",!0),(J=i.selectedFile.metadata)!=null&&J.previewUrl?(f(),R(w,{key:1,href:i.selectedFile.metadata.previewUrl,target:"_blank","prepend-icon":"mdi-open-in-new"},{default:e(()=>o[13]||(o[13]=[n(" Open Preview ",-1)])),_:1,__:[13]},8,["href"])):q("",!0)])]}),_:1})]),_:1})):(f(),R(H,{key:1,class:"text-center pa-8 glass-card"},{default:e(()=>[t(S,{size:"48",color:"grey-lighten-1"},{default:e(()=>o[14]||(o[14]=[n(" mdi-cursor-default-click ",-1)])),_:1,__:[14]}),o[19]||(o[19]=P("p",{class:"text-medium-emphasis mt-2"}," Select a file to view details ",-1)),t(le,{class:"my-4"}),P("div",ut,[o[18]||(o[18]=P("div",{class:"text-subtitle-2 mb-2"}," Facets ",-1)),t(y,{density:"compact"},{default:e(()=>[t(X,null,{default:e(()=>o[15]||(o[15]=[n("Classification",-1)])),_:1,__:[15]}),(f(!0),L(Q,null,W(i.classificationOptions,N=>(f(),R(F,{key:N.value,onClick:J=>r(N.value)},{prepend:e(()=>[t(S,{size:"x-small"},{default:e(()=>o[16]||(o[16]=[n(" mdi-tag ",-1)])),_:1,__:[16]})]),default:e(()=>[t(s,null,{default:e(()=>[n(p(N.label),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),t(le,{class:"my-2"}),t(X,null,{default:e(()=>o[17]||(o[17]=[n("MIME Type",-1)])),_:1,__:[17]}),(f(!0),L(Q,null,W(i.mimeOptions,N=>(f(),R(F,{key:N.value,onClick:J=>d(N.value)},{prepend:e(()=>[t(S,{size:"x-small"},{default:e(()=>[n(p(c(V)(N.value)),1)]),_:2},1024)]),default:e(()=>[t(s,null,{default:e(()=>[n(p(N.label),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])]),_:1,__:[19]}))}}});const pt=fe(ct,[["__scopeId","data-v-2344e6a0"]]),mt=se({__name:"ClassifyDialog",props:{modelValue:{type:Boolean},actionLoading:{type:Boolean},canonicalSlots:{},form:{}},emits:["update:modelValue","submitClassification"],setup(k,{emit:_}){const C=k,$=_,b=G(C.modelValue);ae(()=>C.modelValue,I=>{b.value=I}),ae(b,I=>{$("update:modelValue",I)});function z(){b.value=!1}function V(){$("submitClassification")}return(I,g)=>{const r=a("v-icon"),d=a("v-card-title"),i=a("v-select"),o=a("v-slider"),S=a("v-card-text"),x=a("v-spacer"),s=a("v-btn"),v=a("v-card-actions"),F=a("v-card"),A=a("v-dialog");return f(),R(A,{modelValue:b.value,"onUpdate:modelValue":g[2]||(g[2]=y=>b.value=y),"max-width":"500"},{default:e(()=>[t(F,{class:"glass-card"},{default:e(()=>[t(d,null,{default:e(()=>[t(r,{class:"mr-2"},{default:e(()=>g[3]||(g[3]=[n(" mdi-tag ",-1)])),_:1,__:[3]}),g[4]||(g[4]=n(" Classify File ",-1))]),_:1,__:[4]}),t(S,null,{default:e(()=>[t(i,{modelValue:I.form.canonicalSlot,"onUpdate:modelValue":g[0]||(g[0]=y=>I.form.canonicalSlot=y),items:I.canonicalSlots,"item-title":"key","item-value":"key",label:"Canonical Slot"},null,8,["modelValue","items"]),t(o,{modelValue:I.form.confidence,"onUpdate:modelValue":g[1]||(g[1]=y=>I.form.confidence=y),min:"0",max:"1",step:"0.01",label:"Confidence",class:"mt-4"},null,8,["modelValue"])]),_:1}),t(v,null,{default:e(()=>[t(x),t(s,{variant:"text",onClick:z},{default:e(()=>g[5]||(g[5]=[n(" Cancel ",-1)])),_:1,__:[5]}),t(s,{color:"primary",loading:I.actionLoading,onClick:V},{default:e(()=>g[6]||(g[6]=[n(" Save ",-1)])),_:1,__:[6]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const ft=fe(mt,[["__scopeId","data-v-d645b130"]]);function vt(){ze();const k=G({viewMode:"source",fileViewMode:"table",searchQuery:"",selectedFolders:[],openedFolders:["root"],selectedFiles:[],selectedFile:null,selectedFilters:[],syncStatus:"idle",showUploadDialog:!1,currentProvider:"Unknown",actionLoading:!1,showClassify:!1,entityGroupBy:"project"}),_=G([]),C=T(()=>k.value.entityGroupBy==="project"?"mdi-view-module":"mdi-cloud");return{state:k,folderTree:_,entityGroupIcon:C}}const _t=Y`
  query Files($filter: FileFilter, $limit: Int, $offset: Int) {
    files(filter: $filter, limit: $limit, offset: $offset) {
      id
      orgId
      sourceId
      projectId
      path
      name
      size
      mimeType
      updatedAt
      metadata
      classificationStatus
      classificationConfidence
      canonicalSlot
      current
      deleted
      project { id name }
      source { id name provider }
    }
  }
`,gt=Y`
  subscription OnFileUpdated($orgId: ID!) {
    fileUpdated(orgId: $orgId) {
      id
      orgId
      sourceId
      projectId
      path
      name
      size
      mimeType
      updatedAt
      metadata
      classificationStatus
      classificationConfidence
      canonicalSlot
      current
      deleted
    }
  }
`,yt=Y`
  mutation RenameFile($orgId: ID!, $id: ID!, $name: String!) {
    renameFile(orgId: $orgId, id: $id, name: $name) {
      id
      name
      path
    }
  }
`,Ft=Y`
  mutation MoveFile($orgId: ID!, $id: ID!, $path: String!) {
    moveFile(orgId: $orgId, id: $id, path: $path) {
      id
      name
      path
    }
  }
`;function Le(){var x;const k=lt(),_=G({filter:{orgId:((x=k.currentOrg)==null?void 0:x.id)||"",sourceId:void 0,classificationStatus:void 0,mimeType:void 0,path:void 0,name:void 0},limit:200,offset:0}),{result:C,loading:$,refetch:b,onError:z}=et(_t,_),V=G([]),{mutate:I}=te(yt),{mutate:g}=te(Ft);De(()=>{var s;_.value.filter.orgId=((s=k.currentOrg)==null?void 0:s.id)||""}),De(()=>{var s;(s=C.value)!=null&&s.files&&(V.value=C.value.files)});const{onResult:r}=tt(gt,()=>{var s;return{orgId:((s=k.currentOrg)==null?void 0:s.id)||""}});r(s=>{var A;const v=(A=s.data)==null?void 0:A.fileUpdated;if(!v)return;const F=V.value.findIndex(y=>y.id===v.id);F>=0?V.value[F]={...V.value[F],...v}:V.value.unshift(v)});async function d(s,v){await I({orgId:_.value.filter.orgId,id:s,name:v}),await b()}async function i(s,v){await g({orgId:_.value.filter.orgId,id:s,path:v}),await b()}function o(s){var F;const v=(F=s==null?void 0:s.metadata)==null?void 0:F.downloadUrl;v&&window.open(v,"_blank")}function S(s){var F,A;const v=((F=s==null?void 0:s.metadata)==null?void 0:F.providerUrl)||((A=s==null?void 0:s.metadata)==null?void 0:A.previewUrl);v&&window.open(v,"_blank")}return{items:V,loading:$,refetch:b,onError:z,variables:_,renameFile:d,moveFile:i,downloadFile:o,openInProvider:S}}function wt(k,_){const{items:C,loading:$,renameFile:b,moveFile:z,downloadFile:V,openInProvider:I}=Le(),g=G("");ae(g,o=>{k.value.filter.name=o||void 0,k.value.filter.path=o||void 0,_()});const r=T(()=>{const o={};return C.value.forEach(S=>{const x=S.canonicalSlot||"Unassigned";o[x]=o[x]||[],o[x].push(S)}),o}),d=T(()=>{const o=[],S=r.value;return Object.keys(S).forEach(x=>o.push({key:x,items:S[x]})),o}),i=T(()=>{let o=C.value;if(g.value){const S=g.value.toLowerCase();o=o.filter(x=>x.name.toLowerCase().includes(S)||x.path.toLowerCase().includes(S))}return o});return{items:C,loading:$,searchQuery:g,filesByCanonical:r,filesByCanonicalList:d,filteredFiles:i,renameFile:b,moveFile:z,downloadFile:V,openInProvider:I}}function Ct(){const k=Y`
    mutation TriggerFileReprocessing($fileId: ID!, $orgId: ID!) {
      triggerFileReprocessing(fileId: $fileId, orgId: $orgId)
    }
  `,_=Y`
    mutation ClassifyFile($input: ClassifyFileInput!) {
      classifyFile(input: $input) {
        id
        classificationStatus
        classificationConfidence
        canonicalSlot
        updatedAt
      }
    }
  `,C=Y`
    mutation TriggerFullSync($orgId: ID!) { 
      triggerFullSync(orgId: $orgId) 
    }
  `,$=Y`
    query CanonicalSlots($orgId: ID!) {
      canonicalSlots(orgId: $orgId) { key }
    }
  `,{mutate:b}=te(k),{mutate:z}=te(_),{mutate:V}=te(C);return{triggerReprocessMutate:b,classifyMutate:z,triggerFullSync:V,CANONICAL_SLOTS_QUERY:$}}function bt(k,_,C,$,b,z,V){const I=ze(),g=he(),r=ot(),d=G(!1),i=G(!1),o=G([]);async function S(){if(k.value){d.value=!0;try{await b({fileId:k.value.id,orgId:_.value[0]&&_.value[0].orgId||""}),r.add("success","Reprocessing triggered")}catch(y){r.add("error",y.message||"Failed to trigger reprocessing")}finally{d.value=!1}}}async function x(y){if(k.value){d.value=!0;try{await z({input:{fileId:k.value.id,orgId:_.value[0]&&_.value[0].orgId||C.value.filter.orgId,canonicalSlot:y.value.canonicalSlot,confidence:y.value.confidence}}),r.add("success","File classified"),i.value=!1,$()}catch(w){r.add("error",w.message||"Failed to classify file")}finally{d.value=!1}}}async function s(){}function v(){const y=I.params.id;g.push({name:"MappingStudio",params:{id:y}})}async function F(y,w){const D=window.prompt("Rename file",y.name);if(D&&D!==y.name)try{await w(y.id,D),r.add("success","File renamed")}catch(H){r.add("error",H.message||"Rename failed")}}async function A(y,w){const D=window.prompt("Move file to path",y.path);if(D&&D!==y.path)try{await w(y.id,D),r.add("success","File moved")}catch(H){r.add("error",H.message||"Move failed")}}return{actionLoading:d,showClassify:i,canonicalSlots:o,triggerReprocess:S,submitClassification:x,triggerSync:s,openMappingStudio:v,promptRename:F,promptMove:A}}const It={key:0,class:"text-medium-emphasis pa-4"},kt={class:"px-4 pb-2"},St={key:0,class:"pa-6 text-center"},Mt={key:1,class:"pa-4"},xt={class:"ml-2"},$t={key:2,class:"pa-4"},Vt={class:"ml-2"},Ot=se({__name:"index",setup(k){const{items:_,loading:C,variables:$,refetch:b,renameFile:z,moveFile:V,downloadFile:I,openInProvider:g}=Le(),{state:r,folderTree:d,entityGroupIcon:i}=vt(),{filesByCanonical:o,filesByCanonicalList:S,filteredFiles:x,searchQuery:s}=wt($,b),{getProviderColor:v,getProviderIcon:F,formatFileSize:A,formatDate:y,classificationColor:w,mimeIcon:D,fileHeaders:H,fileFilters:le,classificationOptions:X,mimeOptions:N}=ve(),{triggerReprocessMutate:J,classifyMutate:Z,triggerFullSync:de,CANONICAL_SLOTS_QUERY:Ut}=Ct(),{actionLoading:_e,showClassify:h,canonicalSlots:Te,triggerReprocess:Ae,submitClassification:Oe,triggerSync:Be,openMappingStudio:Pe,promptRename:Et,promptMove:Dt}=bt(r,_,$,b,J,Z),ee=T({get:()=>r.value.viewMode,set:m=>r.value.viewMode=m}),oe=T({get:()=>r.value.fileViewMode,set:m=>r.value.fileViewMode=m}),ge=T({get:()=>r.value.selectedFolders,set:m=>r.value.selectedFolders=m}),ye=T({get:()=>r.value.openedFolders,set:m=>r.value.openedFolders=m});T({get:()=>r.value.selectedFiles,set:m=>r.value.selectedFiles=m});const ne=G(null),Fe=T({get:()=>r.value.selectedFilters,set:m=>r.value.selectedFilters=m}),Ne=T({get:()=>r.value.syncStatus,set:m=>r.value.syncStatus=m}),je=T({get:()=>r.value.showUploadDialog,set:m=>r.value.showUploadDialog=m}),re=T(()=>r.value.currentProvider),ie=T({get:()=>r.value.entityGroupBy,set:m=>r.value.entityGroupBy=m}),Ge=T(()=>{if(ie.value==="project"&&_.value){const m=[],l={};return _.value.forEach(M=>{var O;const U=((O=M.project)==null?void 0:O.id)||"unknown";l[U]||(l[U]=[]),l[U].push(M)}),Object.keys(l).forEach(M=>{var O;const U=(O=_.value.find(E=>{var j;return((j=E.project)==null?void 0:j.id)===M}))==null?void 0:O.project;m.push({key:M,label:(U==null?void 0:U.name)||"Unknown Project",items:l[M]})}),m}else if(ie.value==="source"&&_.value){const m=[],l={};return _.value.forEach(M=>{var O;const U=((O=M.source)==null?void 0:O.id)||"unknown";l[U]||(l[U]=[]),l[U].push(M)}),Object.keys(l).forEach(M=>{var O;const U=(O=_.value.find(E=>{var j;return((j=E.source)==null?void 0:j.id)===M}))==null?void 0:O.source;m.push({key:M,label:(U==null?void 0:U.name)||"Unknown Source",items:l[M]})}),m}return[]}),we=G({canonicalSlot:"",confidence:.8});function Qe(m){if(Array.isArray(m)){const l=m.map(M=>typeof M=="string"?M:M.id);r.value.selectedFolders=l}else r.value.selectedFolders=[]}function We(m){ne.value=m}function Ye(m){}function He(m){}return ae(s,m=>{$.value.filter.name=m||void 0,$.value.filter.path=m||void 0,b()}),(m,l)=>{const M=a("v-col"),U=a("v-btn"),O=a("v-row"),E=a("v-icon"),j=a("v-tab"),Ce=a("v-tabs"),be=a("v-spacer"),K=a("v-chip"),Ie=a("v-card-title"),ke=a("v-text-field"),qe=a("v-treeview"),Se=a("v-card-text"),Me=a("v-card"),Je=a("v-btn-group"),ue=a("v-list-item-title"),ce=a("v-list-item"),pe=a("v-list"),Ke=a("v-menu"),Xe=a("v-chip-group"),xe=a("v-expansion-panel-title"),$e=a("v-list-item-subtitle"),Ve=a("v-expansion-panel-text"),Ue=a("v-expansion-panel"),Ee=a("v-expansion-panels");return f(),L("div",null,[t(O,{class:"mb-4"},{default:e(()=>[t(M,{cols:"12",md:"8"},{default:e(()=>l[13]||(l[13]=[P("h1",{class:"text-h4 font-weight-bold"},"File Explorer",-1),P("p",{class:"text-subtitle-1 text-medium-emphasis"}," Browse and manage project files from connected storage ",-1)])),_:1,__:[13]}),t(M,{cols:"12",md:"4",class:"text-right"},{default:e(()=>[t(U,{color:"primary","prepend-icon":"mdi-sync",loading:Ne.value==="syncing",onClick:c(Be)},{default:e(()=>l[14]||(l[14]=[n(" Sync Now ",-1)])),_:1,__:[14]},8,["loading","onClick"]),t(U,{class:"ml-2","prepend-icon":"mdi-upload",onClick:l[0]||(l[0]=u=>je.value=!0)},{default:e(()=>l[15]||(l[15]=[n(" Upload ",-1)])),_:1,__:[15]})]),_:1})]),_:1}),t(Ce,{modelValue:ee.value,"onUpdate:modelValue":l[1]||(l[1]=u=>ee.value=u),class:"mb-4"},{default:e(()=>[t(j,{value:"source"},{default:e(()=>[t(E,{start:""},{default:e(()=>l[16]||(l[16]=[n("mdi-folder-outline",-1)])),_:1,__:[16]}),l[17]||(l[17]=n(" Source View ",-1))]),_:1,__:[17]}),t(j,{value:"canonical"},{default:e(()=>[t(E,{start:""},{default:e(()=>l[18]||(l[18]=[n("mdi-folder-star",-1)])),_:1,__:[18]}),l[19]||(l[19]=n(" Canonical View ",-1))]),_:1,__:[19]}),t(j,{value:"entity"},{default:e(()=>[t(E,{start:""},{default:e(()=>l[20]||(l[20]=[n("mdi-sitemap",-1)])),_:1,__:[20]}),l[21]||(l[21]=n(" Entity View ",-1))]),_:1,__:[21]})]),_:1},8,["modelValue"]),t(O,null,{default:e(()=>[t(M,{cols:"12",lg:"3"},{default:e(()=>[t(Me,{class:"glass-card"},{default:e(()=>[t(Ie,{class:"d-flex align-center"},{default:e(()=>[t(E,{class:"mr-2"},{default:e(()=>l[22]||(l[22]=[n("mdi-folder-multiple",-1)])),_:1,__:[22]}),l[23]||(l[23]=n(" Folders ",-1)),t(be),t(K,{color:c(v)(re.value),size:"small",variant:"tonal"},{default:e(()=>[t(E,{start:"",size:"small"},{default:e(()=>[n(p(c(F)(re.value)),1)]),_:1}),n(" "+p(re.value),1)]),_:1},8,["color"])]),_:1,__:[23]}),t(Se,{class:"pa-0"},{default:e(()=>[t(ke,{modelValue:c(s),"onUpdate:modelValue":l[2]||(l[2]=u=>me(s)?s.value=u:null),placeholder:"Search files...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":"",class:"ma-3"},null,8,["modelValue"]),c(d).length===0?(f(),L("div",It," Folder tree integration is coming soon. ")):(f(),R(qe,{key:1,selected:ge.value,"onUpdate:selected":[l[3]||(l[3]=u=>ge.value=u),Qe],opened:ye.value,"onUpdate:opened":l[4]||(l[4]=u=>ye.value=u),items:c(d),"item-key":"id","item-title":"name","item-children":"children",selectable:"","open-on-click":""},{prepend:e(({item:u})=>[t(E,{size:"small"},{default:e(()=>[n(p(u.type==="folder"?"mdi-folder":"mdi-file"),1)]),_:2},1024)]),_:1},8,["selected","opened","items"]))]),_:1})]),_:1})]),_:1}),t(M,{cols:"12",lg:"6"},{default:e(()=>[t(Me,{class:"glass-card"},{default:e(()=>[t(Ie,{class:"d-flex align-center"},{default:e(()=>[t(E,{class:"mr-2"},{default:e(()=>l[24]||(l[24]=[n("mdi-file-multiple",-1)])),_:1,__:[24]}),l[25]||(l[25]=n(" Files ",-1)),t(be),t(Je,{density:"compact"},{default:e(()=>[t(U,{variant:oe.value==="table"?"flat":"text",icon:"mdi-view-list",onClick:l[5]||(l[5]=u=>oe.value="table")},null,8,["variant"]),t(U,{variant:oe.value==="grid"?"flat":"text",icon:"mdi-view-grid",onClick:l[6]||(l[6]=u=>oe.value="grid")},null,8,["variant"])]),_:1})]),_:1,__:[25]}),t(Se,{class:"pa-0"},{default:e(()=>[ee.value==="source"?(f(),L(Q,{key:0},[P("div",kt,[t(ke,{modelValue:c(s),"onUpdate:modelValue":l[7]||(l[7]=u=>me(s)?s.value=u:null),placeholder:"Search files...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":"",class:"mb-2"},null,8,["modelValue"]),t(Xe,{modelValue:Fe.value,"onUpdate:modelValue":l[8]||(l[8]=u=>Fe.value=u),multiple:""},{default:e(()=>[(f(!0),L(Q,null,W(c(le),u=>(f(),R(K,{key:u.key,value:u.key,size:"small",variant:"outlined"},{default:e(()=>[t(E,{start:"",size:"small"},{default:e(()=>[n(p(u.icon),1)]),_:2},1024),n(" "+p(u.label),1)]),_:2},1032,["value"]))),128)),t(Ke,null,{activator:e(({props:u})=>[t(K,Re(u,{size:"small",variant:"outlined","prepend-icon":"mdi-filter"}),{default:e(()=>l[26]||(l[26]=[n(" Classification ",-1)])),_:2,__:[26]},1040)]),default:e(()=>[t(pe,null,{default:e(()=>[(f(!0),L(Q,null,W(c(X),u=>(f(),R(ce,{key:u.value,onClick:B=>(u.value,void 0)},{default:e(()=>[t(ue,null,{default:e(()=>[n(p(u.label),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t(at,{"filtered-files":c(x),loading:c(C),"rename-file":c(z),"move-file":c(V),"download-file":c(I),"open-in-provider":c(g),onFileSelect:We},null,8,["filtered-files","loading","rename-file","move-file","download-file","open-in-provider"])],64)):ee.value==="entity"?(f(),L(Q,{key:1},[Object.keys(c(o).value).length===0?(f(),L("div",St,[t(E,{size:"56",color:"primary",class:"mb-3"},{default:e(()=>l[27]||(l[27]=[n("mdi-folder-star",-1)])),_:1,__:[27]}),l[29]||(l[29]=P("div",{class:"text-h6 mb-2"},"No canonical groupings yet",-1)),l[30]||(l[30]=P("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Configure taxonomy rules and classifications in Mapping Studio to enable canonical slot grouping. ",-1)),t(U,{color:"primary","prepend-icon":"mdi-map",onClick:c(Pe)},{default:e(()=>l[28]||(l[28]=[n(" Open Mapping Studio ",-1)])),_:1,__:[28]},8,["onClick"])])):(f(),L("div",Mt,[t(Ee,{variant:"accordion"},{default:e(()=>[(f(!0),L(Q,null,W(c(S),u=>(f(),R(Ue,{key:u.key},{default:e(()=>[t(xe,null,{default:e(()=>[t(E,{start:""},{default:e(()=>l[31]||(l[31]=[n("mdi-folder-star",-1)])),_:1,__:[31]}),P("span",xt,p(u.key||"Unassigned"),1),t(K,{class:"ml-3",size:"x-small",label:""},{default:e(()=>[n(p(u.items.length),1)]),_:2},1024)]),_:2},1024),t(Ve,null,{default:e(()=>[t(pe,{density:"compact"},{default:e(()=>[(f(!0),L(Q,null,W(u.items,B=>(f(),R(ce,{key:B.id,onClick:Ze=>ne.value=B},{prepend:e(()=>[t(E,{size:"small"},{default:e(()=>[n(p(c(D)(B.mimeType)),1)]),_:2},1024)]),append:e(()=>[t(K,{size:"x-small",color:c(w)(B.classificationStatus),variant:"tonal"},{default:e(()=>[n(p(B.classificationStatus),1)]),_:2},1032,["color"])]),default:e(()=>[t(ue,null,{default:e(()=>[n(p(B.name),1)]),_:2},1024),t($e,null,{default:e(()=>[n(p(B.path),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))],64)):ee.value==="entity"?(f(),L("div",$t,[t(Ce,{modelValue:ie.value,"onUpdate:modelValue":l[9]||(l[9]=u=>ie.value=u),density:"compact",class:"mb-3"},{default:e(()=>[t(j,{value:"project"},{default:e(()=>[t(E,{start:""},{default:e(()=>l[32]||(l[32]=[n("mdi-view-module",-1)])),_:1,__:[32]}),l[33]||(l[33]=n("By Project ",-1))]),_:1,__:[33]}),t(j,{value:"source"},{default:e(()=>[t(E,{start:""},{default:e(()=>l[34]||(l[34]=[n("mdi-cloud",-1)])),_:1,__:[34]}),l[35]||(l[35]=n("By Source ",-1))]),_:1,__:[35]})]),_:1},8,["modelValue"]),t(Ee,null,{default:e(()=>[(f(!0),L(Q,null,W(Ge.value,u=>(f(),R(Ue,{key:u.key},{default:e(()=>[t(xe,null,{default:e(()=>[t(E,{start:""},{default:e(()=>[n(p(c(i)),1)]),_:1}),P("span",Vt,p(u.label),1),t(K,{class:"ml-3",size:"x-small",label:""},{default:e(()=>[n(p(u.items.length),1)]),_:2},1024)]),_:2},1024),t(Ve,null,{default:e(()=>[t(pe,{density:"compact"},{default:e(()=>[(f(!0),L(Q,null,W(u.items,B=>(f(),R(ce,{key:B.id,onClick:Ze=>ne.value=B},{prepend:e(()=>[t(E,{size:"small"},{default:e(()=>[n(p(c(D)(B.mimeType)),1)]),_:2},1024)]),default:e(()=>[t(ue,null,{default:e(()=>[n(p(B.name),1)]),_:2},1024),t($e,null,{default:e(()=>[n(p(B.path),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):q("",!0)]),_:1})]),_:1})]),_:1}),t(M,{cols:"12",lg:"3"},{default:e(()=>[t(pt,{"selected-file":ne.value,"action-loading":c(_e),"show-classify":c(h),"classification-options":c(X),"mime-options":c(N),onTriggerReprocess:c(Ae),onShowClassify:l[10]||(l[10]=u=>h.value=u),onApplyClassificationFilter:Ye,onApplyMimeFilter:He},null,8,["selected-file","action-loading","show-classify","classification-options","mime-options","onTriggerReprocess"])]),_:1})]),_:1}),t(ft,{modelValue:c(h),"onUpdate:modelValue":l[11]||(l[11]=u=>me(h)?h.value=u:null),form:we.value,"canonical-slots":c(Te),"action-loading":c(_e),onSubmitClassification:l[12]||(l[12]=u=>c(Oe)(we.value))},null,8,["modelValue","form","canonical-slots","action-loading"])])}}});export{Ot as default};
