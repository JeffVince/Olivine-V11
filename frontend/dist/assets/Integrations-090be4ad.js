import{v as Ve,r as d,M as De,w as Re,ac as C,A as t,a9 as o,aj as Te,a5 as s,a7 as v,E as m,_ as n,F as j,ad as le,a8 as F,W as u,ae as z,D as Ee,B as Le}from"./vue-063894f7.js";import{a as We,b as Ue}from"./index-84fcf405.js";import{g as H,u as Ne,h as ae}from"./apollo-3ed1981b.js";import"./supabase-cf010ec4.js";const Ae={class:"text-h6"},qe={class:"text-body-2 mb-3"},Oe={key:0,class:"mb-3"},Pe={key:1,class:"mb-3"},Ge={class:"text-center"},Be={class:"text-h6"},Me={class:"text-center"},je={class:"text-h6"},He={class:"text-subtitle-1 mb-2"},Ze={class:"text-body-2 text-medium-emphasis"},ot=Ve({__name:"Integrations",setup(Je){const Z="http://localhost:8080/api",ne=Te(),g=We(),U=d([]),w=d(!1),$=d(!1),R=d(!1),h=d(""),S=d(null),J=d(null),N=d(null),A=d(null),q=d(!1),O=d(!1),P=d(!1),Q=d([]),y=d({rootFolder:"",enableWebhooks:!0,syncFrequency:"hourly"}),G=Ue(),se=H`
  query GetSources($organizationId: ID!) {
    getSources(organizationId: $organizationId) {
      id
      organizationId
      name
      type
      active
      updatedAt
      config
    }
  }
`,re=H`
  mutation CreateSource($organizationId: ID!, $name: String!, $type: SourceType!, $config: JSON) {
    createSource(organizationId: $organizationId, name: $name, type: $type, config: $config) {
      id
      name
      type
      organizationId
      active
    }
  }
`,ie=H`
  mutation TriggerSourceResync($sourceId: ID!, $organizationId: ID!) {
    triggerSourceResync(sourceId: $sourceId, organizationId: $organizationId)
  }
`,{result:T,loading:Qe,refetch:Ye}=Ne(se,()=>{var a;return{organizationId:((a=G.currentOrg)==null?void 0:a.id)||""}}),{mutate:de}=ae(re),{mutate:ue}=ae(ie),B=[{type:"dropbox",name:"Dropbox",description:"Connect to Dropbox for file storage and sync"},{type:"googledrive",name:"Google Drive",description:"Connect to Google Drive for file storage and sync"},{type:"frameio",name:"Frame.io",description:"Share artifacts and collaborate on Frame.io"},{type:"slack",name:"Slack",description:"Send notifications and updates to Slack channels"},{type:"gmail",name:"Gmail",description:"Send email notifications and distribute call sheets"}],ce=[{title:"Every 15 minutes",value:"15min"},{title:"Every 30 minutes",value:"30min"},{title:"Hourly",value:"hourly"},{title:"Every 6 hours",value:"6hours"},{title:"Daily",value:"daily"}],me=[{title:"Level",key:"level",sortable:!0},{title:"Message",key:"message",sortable:!1},{title:"Timestamp",key:"timestamp",sortable:!0}];function Y(a){switch(a){case"dropbox":return"blue";case"googledrive":return"green";case"frameio":return"purple";case"slack":return"deep-purple";case"gmail":return"red";default:return"grey"}}function K(a){switch(a){case"dropbox":return"mdi-dropbox";case"googledrive":return"mdi-google-drive";case"frameio":return"mdi-play-box";case"slack":return"mdi-slack";case"gmail":return"mdi-gmail";default:return"mdi-puzzle"}}function ve(a){switch(a){case"info":return"primary";case"warning":return"warning";case"error":return"error";default:return"grey"}}function fe(a){return new Date(a).toLocaleDateString()}function _e(a){return new Date(a).toLocaleString()}async function X(a){var e,r,i;N.value=a.id;try{const _=(e=G.currentOrg)==null?void 0:e.id;if(!_)throw new Error("No organization selected");let c=a.id;if(!a.__existing){const D=a.type==="googledrive"?"google_drive":a.type,f=await de({organizationId:_,name:a.name,type:D,config:{}});if(c=(i=(r=f==null?void 0:f.data)==null?void 0:r.createSource)==null?void 0:i.id,!c)throw new Error("Failed to create source");a.id=c,a.__existing=!0}const V=a.type==="dropbox"?"/api/oauth/dropbox":"/api/oauth/gdrive",p=Z?new URL(V,Z):new URL(V,window.location.origin);p.searchParams.set("organizationId",_),p.searchParams.set("sourceId",c);const b=ne.params.id||"";p.searchParams.set("state",JSON.stringify({organizationId:_,sourceId:c,projectId:b})),window.location.href=p.toString()}catch{g.add("error",`Failed to connect ${a.name}`)}finally{N.value=null}}async function pe(a){try{a.connected=!1,a.lastSync=void 0,a.webhookStatus=void 0,a.stats=void 0,g.add("info",`${a.name} disconnected`)}catch{g.add("error",`Failed to disconnect ${a.name}`)}}async function ge(a){var e;A.value=a.id;try{const r=(e=G.currentOrg)==null?void 0:e.id;if(!r)throw new Error("No organization selected");await ue({sourceId:a.id,organizationId:r}),a.lastSync=new Date().toISOString(),g.add("success",`${a.name} sync triggered`)}catch{g.add("error",`Failed to sync ${a.name}`)}finally{A.value=null}}function ye(a){S.value=a,y.value={rootFolder:a.rootFolder||"",enableWebhooks:a.webhookStatus==="active",syncFrequency:"hourly"},$.value=!0}async function be(){if(S.value){q.value=!0;try{await new Promise(a=>setTimeout(a,1e3)),S.value.rootFolder=y.value.rootFolder,S.value.webhookStatus=y.value.enableWebhooks?"active":"inactive",$.value=!1,g.add("success","Configuration saved successfully")}catch{g.add("error","Failed to save configuration")}finally{q.value=!1}}}function ke(a){J.value=a,O.value=!0,Q.value=[{id:"1",level:"info",message:"Webhook subscription renewed",timestamp:"2024-01-15T10:30:00Z"},{id:"2",level:"info",message:"Sync completed successfully - 12 files processed",timestamp:"2024-01-15T09:15:00Z"},{id:"3",level:"warning",message:"File naming convention violation detected",timestamp:"2024-01-15T08:45:00Z"}],setTimeout(()=>{O.value=!1},500),R.value=!0}async function we(a){try{await new Promise(e=>setTimeout(e,1e3)),a.webhookStatus="active",g.add("success","Webhook resubscribed successfully")}catch{g.add("error","Failed to resubscribe webhook")}}function Se(a){h.value=a.type,w.value=!0}function xe(){const a=B.find(r=>r.type===h.value);if(!a)return;const e={id:Date.now().toString(),type:a.type,name:a.name,description:a.description,connected:!1};U.value.push(e),w.value=!1,setTimeout(()=>{X(e)},500)}De(()=>{T.value&&ee()}),Re(T,()=>ee());function ee(){var a;(a=T.value)!=null&&a.getSources&&(U.value=T.value.getSources.map(e=>{var r,i;return{id:e.id,type:e.type==="google_drive"?"googledrive":e.type,name:e.name,description:e.type==="dropbox"?"Dropbox storage":e.type==="google_drive"?"Google Drive storage":e.type,connected:e.active,lastSync:e.updatedAt,rootFolder:(r=e.config)==null?void 0:r.rootFolder,webhookStatus:(i=e.config)!=null&&i.enableWebhooks?"active":"inactive",stats:void 0,__existing:!0}}))}return(a,e)=>{const r=s("v-col"),i=s("v-btn"),_=s("v-row"),c=s("v-icon"),V=s("v-avatar"),E=s("v-chip"),p=s("v-card-title"),b=s("v-list-item-title"),D=s("v-list-item-subtitle"),f=s("v-list-item"),te=s("v-list"),x=s("v-card-text"),L=s("v-spacer"),Ie=s("v-divider"),Ce=s("v-menu"),W=s("v-card-actions"),I=s("v-card"),oe=s("v-select"),M=s("v-dialog"),Fe=s("v-text-field"),ze=s("v-switch"),$e=s("v-form"),he=s("v-data-table");return v(),C("div",null,[t(_,{class:"mb-4"},{default:o(()=>[t(r,{cols:"12",md:"8"},{default:o(()=>e[12]||(e[12]=[m("h1",{class:"text-h4 font-weight-bold"}," Integrations ",-1),m("p",{class:"text-subtitle-1 text-medium-emphasis"}," Connect and manage external services for your project ",-1)])),_:1,__:[12]}),t(r,{cols:"12",md:"4",class:"text-right"},{default:o(()=>[t(i,{color:"primary","prepend-icon":"mdi-plus",class:"liquid-button",onClick:e[0]||(e[0]=l=>w.value=!0)},{default:o(()=>e[13]||(e[13]=[n(" Add Integration ",-1)])),_:1,__:[13]})]),_:1})]),_:1}),t(_,null,{default:o(()=>[(v(!0),C(j,null,le(U.value,l=>(v(),F(r,{key:l.id,cols:"12",md:"6",lg:"4"},{default:o(()=>[t(I,{class:Ee(["integration-card glass-card",{connected:l.connected}])},{default:o(()=>[t(p,{class:"d-flex align-center"},{default:o(()=>[t(V,{color:Y(l.type),class:"mr-3",size:"40"},{default:o(()=>[t(c,{icon:K(l.type)},null,8,["icon"])]),_:2},1032,["color"]),m("div",null,[m("div",Ae,u(l.name),1),t(E,{color:l.connected?"success":"warning",size:"small",variant:"tonal"},{default:o(()=>[n(u(l.connected?"Connected":"Disconnected"),1)]),_:2},1032,["color"])])]),_:2},1024),t(x,null,{default:o(()=>[m("p",qe,u(l.description),1),l.connected?(v(),C("div",Oe,[t(te,{density:"compact"},{default:o(()=>[l.lastSync?(v(),F(f,{key:0},{default:o(()=>[t(b,null,{default:o(()=>e[14]||(e[14]=[n("Last Sync",-1)])),_:1,__:[14]}),t(D,null,{default:o(()=>[n(u(fe(l.lastSync)),1)]),_:2},1024)]),_:2},1024)):z("",!0),l.rootFolder?(v(),F(f,{key:1},{default:o(()=>[t(b,null,{default:o(()=>e[15]||(e[15]=[n("Root Folder",-1)])),_:1,__:[15]}),t(D,null,{default:o(()=>[n(u(l.rootFolder),1)]),_:2},1024)]),_:2},1024)):z("",!0),l.webhookStatus?(v(),F(f,{key:2},{default:o(()=>[t(b,null,{default:o(()=>e[16]||(e[16]=[n("Webhook Status",-1)])),_:1,__:[16]}),t(D,null,{default:o(()=>[t(E,{color:l.webhookStatus==="active"?"success":"warning",size:"x-small"},{default:o(()=>[n(u(l.webhookStatus),1)]),_:2},1032,["color"])]),_:2},1024)]),_:2},1024)):z("",!0)]),_:2},1024)])):z("",!0),l.stats?(v(),C("div",Pe,[t(_,null,{default:o(()=>[t(r,{cols:"6"},{default:o(()=>[m("div",Ge,[m("div",Be,u(l.stats.files),1),e[17]||(e[17]=m("div",{class:"text-caption text-medium-emphasis"}," Files ",-1))])]),_:2},1024),t(r,{cols:"6"},{default:o(()=>[m("div",Me,[m("div",je,u(l.stats.folders),1),e[18]||(e[18]=m("div",{class:"text-caption text-medium-emphasis"}," Folders ",-1))])]),_:2},1024)]),_:2},1024)])):z("",!0)]),_:2},1024),t(W,null,{default:o(()=>[l.connected?(v(),C(j,{key:1},[t(i,{color:"primary",variant:"outlined",loading:A.value===l.id,onClick:k=>ge(l)},{default:o(()=>e[20]||(e[20]=[n(" Sync Now ",-1)])),_:2,__:[20]},1032,["loading","onClick"]),t(L),t(Ce,null,{activator:o(({props:k})=>[t(i,Le({ref_for:!0},k,{icon:"mdi-dots-vertical",variant:"text",size:"small"}),null,16)]),default:o(()=>[t(te,null,{default:o(()=>[t(f,{onClick:k=>ye(l)},{default:o(()=>[t(b,null,{default:o(()=>[t(c,{start:""},{default:o(()=>e[21]||(e[21]=[n(" mdi-cog ",-1)])),_:1,__:[21]}),e[22]||(e[22]=n(" Configure ",-1))]),_:1,__:[22]})]),_:2},1032,["onClick"]),t(f,{onClick:k=>ke(l)},{default:o(()=>[t(b,null,{default:o(()=>[t(c,{start:""},{default:o(()=>e[23]||(e[23]=[n(" mdi-text-box ",-1)])),_:1,__:[23]}),e[24]||(e[24]=n(" View Logs ",-1))]),_:1,__:[24]})]),_:2},1032,["onClick"]),t(f,{onClick:k=>we(l)},{default:o(()=>[t(b,null,{default:o(()=>[t(c,{start:""},{default:o(()=>e[25]||(e[25]=[n(" mdi-webhook ",-1)])),_:1,__:[25]}),e[26]||(e[26]=n(" Resubscribe Webhook ",-1))]),_:1,__:[26]})]),_:2},1032,["onClick"]),t(Ie),t(f,{class:"text-error",onClick:k=>pe(l)},{default:o(()=>[t(b,null,{default:o(()=>[t(c,{start:""},{default:o(()=>e[27]||(e[27]=[n(" mdi-link-off ",-1)])),_:1,__:[27]}),e[28]||(e[28]=n(" Disconnect ",-1))]),_:1,__:[28]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)],64)):(v(),F(i,{key:0,color:"primary",variant:"flat",loading:N.value===l.id,onClick:k=>X(l)},{default:o(()=>e[19]||(e[19]=[n(" Connect ",-1)])),_:2,__:[19]},1032,["loading","onClick"]))]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}),t(I,{class:"mt-6 glass-card"},{default:o(()=>[t(p,null,{default:o(()=>[t(c,{class:"mr-2"},{default:o(()=>e[29]||(e[29]=[n(" mdi-store ",-1)])),_:1,__:[29]}),e[30]||(e[30]=n(" Available Integrations ",-1))]),_:1,__:[30]}),t(x,null,{default:o(()=>[t(_,null,{default:o(()=>[(v(),C(j,null,le(B,l=>t(r,{key:l.type,cols:"12",sm:"6",md:"4"},{default:o(()=>[t(I,{variant:"outlined",class:"available-integration",onClick:k=>Se(l)},{default:o(()=>[t(x,{class:"text-center pa-4"},{default:o(()=>[t(V,{color:Y(l.type),size:"48",class:"mb-3"},{default:o(()=>[t(c,{icon:K(l.type),size:"24"},null,8,["icon"])]),_:2},1032,["color"]),m("h4",He,u(l.name),1),m("p",Ze,u(l.description),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)),64))]),_:1})]),_:1})]),_:1}),t(M,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=l=>w.value=l),"max-width":"500"},{default:o(()=>[t(I,{class:"glass-card"},{default:o(()=>[t(p,null,{default:o(()=>e[31]||(e[31]=[n("Add Integration",-1)])),_:1,__:[31]}),t(x,null,{default:o(()=>[t(oe,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=l=>h.value=l),items:B,"item-title":"name","item-value":"type",label:"Select Integration Type","prepend-icon":"mdi-puzzle"},null,8,["modelValue"])]),_:1}),t(W,null,{default:o(()=>[t(L),t(i,{variant:"text",onClick:e[2]||(e[2]=l=>w.value=!1)},{default:o(()=>e[32]||(e[32]=[n(" Cancel ",-1)])),_:1,__:[32]}),t(i,{color:"primary",disabled:!h.value,onClick:xe},{default:o(()=>e[33]||(e[33]=[n(" Continue ",-1)])),_:1,__:[33]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=l=>$.value=l),"max-width":"600"},{default:o(()=>[S.value?(v(),F(I,{key:0,class:"glass-card"},{default:o(()=>[t(p,null,{default:o(()=>[n(" Configure "+u(S.value.name),1)]),_:1}),t(x,null,{default:o(()=>[t($e,{ref:"configForm",modelValue:P.value,"onUpdate:modelValue":e[7]||(e[7]=l=>P.value=l)},{default:o(()=>[t(Fe,{modelValue:y.value.rootFolder,"onUpdate:modelValue":e[4]||(e[4]=l=>y.value.rootFolder=l),label:"Root Folder Path","prepend-icon":"mdi-folder",hint:"The folder path to monitor for changes","persistent-hint":""},null,8,["modelValue"]),t(ze,{modelValue:y.value.enableWebhooks,"onUpdate:modelValue":e[5]||(e[5]=l=>y.value.enableWebhooks=l),label:"Enable Real-time Webhooks",hint:"Receive instant notifications for file changes","persistent-hint":"",class:"mt-4"},null,8,["modelValue"]),t(oe,{modelValue:y.value.syncFrequency,"onUpdate:modelValue":e[6]||(e[6]=l=>y.value.syncFrequency=l),items:ce,label:"Sync Frequency","prepend-icon":"mdi-clock",hint:"How often to check for changes if webhooks are disabled","persistent-hint":"",class:"mt-4"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(W,null,{default:o(()=>[t(L),t(i,{variant:"text",onClick:e[8]||(e[8]=l=>$.value=!1)},{default:o(()=>e[34]||(e[34]=[n(" Cancel ",-1)])),_:1,__:[34]}),t(i,{color:"primary",disabled:!P.value,loading:q.value,onClick:be},{default:o(()=>e[35]||(e[35]=[n(" Save Configuration ",-1)])),_:1,__:[35]},8,["disabled","loading"])]),_:1})]),_:1})):z("",!0)]),_:1},8,["modelValue"]),t(M,{modelValue:R.value,"onUpdate:modelValue":e[11]||(e[11]=l=>R.value=l),"max-width":"800"},{default:o(()=>[t(I,{class:"glass-card"},{default:o(()=>[t(p,null,{default:o(()=>{var l;return[n(" Integration Logs - "+u((l=J.value)==null?void 0:l.name),1)]}),_:1}),t(x,null,{default:o(()=>[t(he,{items:Q.value,headers:me,"item-key":"id",density:"compact",loading:O.value},{"item.level":o(({item:l})=>[t(E,{color:ve(l.level),size:"small",variant:"tonal"},{default:o(()=>[n(u(l.level),1)]),_:2},1032,["color"])]),"item.timestamp":o(({item:l})=>[n(u(_e(l.timestamp)),1)]),_:1},8,["items","loading"])]),_:1}),t(W,null,{default:o(()=>[t(L),t(i,{variant:"text",onClick:e[10]||(e[10]=l=>R.value=!1)},{default:o(()=>e[36]||(e[36]=[n(" Close ",-1)])),_:1,__:[36]})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{ot as default};
