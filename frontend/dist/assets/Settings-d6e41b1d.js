import{v as L,r,aj as O,M as T,ac as I,E as z,A as t,a9 as o,a5 as n,a7 as D,_ as m,a3 as S}from"./vue-b3dbcb9b.js";import{c as G,a as H,u as J}from"./index-84246d85.js";import"./apollo-e4ecfb61.js";import"./supabase-cf010ec4.js";const Z=L({__name:"Settings",setup(K){var F,x;const f=r("profile"),p=G(),i=H(),c=J(),P=O(),U=r(),v=r({name:((F=p.user)==null?void 0:F.name)||"",avatar:((x=p.user)==null?void 0:x.avatar)||""}),k=r(),u=r({...p.notificationPrefs}),N=r(),s=r({name:"",templates:[],autoApprove:!1}),g=[l=>!!l||"Name is required"],M=[l=>!l||/^https?:\/\//.test(l)||"Must be a valid URL"];T(async()=>{var e,d;c.projects.length||await c.fetchProjects();const l=c.projects.find(V=>V.id===P.params.id);l&&(s.value.name=l.name,s.value.templates=((e=l.settings)==null?void 0:e.templates)||[],s.value.autoApprove=((d=l.settings)==null?void 0:d.autoApprove)||!1)});async function R(){const{valid:l}=await U.value.validate();if(l)try{await p.updateProfile(v.value),i.add("success","Profile updated")}catch{i.add("error","Failed to update profile")}}async function q(){try{await p.updateNotificationPrefs(u.value),i.add("success","Notification preferences saved")}catch{i.add("error","Failed to save notifications")}}async function B(){const{valid:l}=await N.value.validate();if(l)try{await c.updateProjectOptions(P.params.id,{name:s.value.name,templates:s.value.templates,autoApprove:s.value.autoApprove}),i.add("success","Project settings saved")}catch{i.add("error","Failed to save project settings")}}return(l,e)=>{const d=n("v-tab"),V=n("v-tabs"),b=n("v-text-field"),j=n("v-btn"),w=n("v-card"),y=n("v-form"),A=n("v-window-item"),_=n("v-switch"),C=n("v-combobox"),E=n("v-window");return D(),I("div",null,[e[16]||(e[16]=z("h2",null,"Settings",-1)),t(V,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),density:"compact",class:"mb-4"},{default:o(()=>[t(d,{value:"profile"},{default:o(()=>e[10]||(e[10]=[m(" Profile ",-1)])),_:1,__:[10]}),t(d,{value:"notifications"},{default:o(()=>e[11]||(e[11]=[m(" Notifications ",-1)])),_:1,__:[11]}),t(d,{value:"project"},{default:o(()=>e[12]||(e[12]=[m(" Project ",-1)])),_:1,__:[12]})]),_:1},8,["modelValue"]),t(E,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=a=>f.value=a)},{default:o(()=>[t(A,{value:"profile"},{default:o(()=>[t(y,{ref_key:"profileForm",ref:U,onSubmit:S(R,["prevent"])},{default:o(()=>[t(w,{class:"glass-card pa-4 mb-4"},{default:o(()=>[t(b,{modelValue:v.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value.name=a),label:"Name",rules:g,required:""},null,8,["modelValue"]),t(b,{modelValue:v.value.avatar,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value.avatar=a),label:"Avatar URL",rules:M},null,8,["modelValue"]),t(j,{type:"submit",color:"primary"},{default:o(()=>e[13]||(e[13]=[m(" Save ",-1)])),_:1,__:[13]})]),_:1})]),_:1},512)]),_:1}),t(A,{value:"notifications"},{default:o(()=>[t(y,{ref_key:"notifForm",ref:k,onSubmit:S(q,["prevent"])},{default:o(()=>[t(w,{class:"glass-card pa-4 mb-4"},{default:o(()=>[t(_,{modelValue:u.value.email,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.email=a),label:"Email"},null,8,["modelValue"]),t(_,{modelValue:u.value.sms,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.sms=a),label:"SMS"},null,8,["modelValue"]),t(_,{modelValue:u.value.inApp,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.inApp=a),label:"In-App"},null,8,["modelValue"]),t(j,{type:"submit",color:"primary"},{default:o(()=>e[14]||(e[14]=[m(" Save ",-1)])),_:1,__:[14]})]),_:1})]),_:1},512)]),_:1}),t(A,{value:"project"},{default:o(()=>[t(y,{ref_key:"projectForm",ref:N,onSubmit:S(B,["prevent"])},{default:o(()=>[t(w,{class:"glass-card pa-4 mb-4"},{default:o(()=>[t(b,{modelValue:s.value.name,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.name=a),label:"Project Name",rules:g,required:""},null,8,["modelValue"]),t(C,{modelValue:s.value.templates,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.templates=a),label:"Templates",multiple:"",chips:"","hide-selected":""},null,8,["modelValue"]),t(_,{modelValue:s.value.autoApprove,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.autoApprove=a),label:"Auto-approve tasks"},null,8,["modelValue"]),t(j,{type:"submit",color:"primary"},{default:o(()=>e[15]||(e[15]=[m(" Save ",-1)])),_:1,__:[15]})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])])}}});export{Z as default};
