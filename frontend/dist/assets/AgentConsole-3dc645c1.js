import{b as re,a as je}from"./index-84fcf405.js";import{g as E,u as ce,j as oe,h as ie}from"./apollo-3ed1981b.js";import{r as u,k as me,v as Ne,c as I,ac as F,A as t,a9 as l,a5 as i,a7 as $,E as o,_ as n,W as m,F as ue,ad as de,u as Fe,a8 as Y,D as Re,B as Be,ae as Pe}from"./vue-063894f7.js";import{_ as He}from"./_plugin-vue_export-helper-c27b6911.js";import"./supabase-cf010ec4.js";const Me=E`
  query AgentJobs($orgId: ID!, $status: JobStatus, $type: JobType, $limit: Int, $offset: Int) {
    agentJobs(orgId: $orgId, status: $status, type: $type, limit: $limit, offset: $offset) {
      id
      orgId
      type
      target
      status
      priority
      attemptsMade
      retries
      worker
      startedAt
      finishedAt
      durationMs
      params
    }
  }
`,Qe=E`
  mutation EnqueueAgentJob($input: EnqueueAgentJobInput!) {
    enqueueAgentJob(input: $input) {
      id
      type
      status
    }
  }
`,Ge=E`
  mutation CancelAgentJob($orgId: ID!, $id: ID!) {
    cancelAgentJob(orgId: $orgId, id: $id)
  }
`,We=E`
  subscription JobUpdated($orgId: ID!) {
    jobUpdated(orgId: $orgId) {
      id
      orgId
      type
      target
      status
      priority
      attemptsMade
      retries
      worker
      startedAt
      finishedAt
      durationMs
      params
    }
  }
`,Ke=E`
  subscription JobLogAppended($jobId: ID!) {
    jobLogAppended(jobId: $jobId) {
      jobId
      timestamp
      level
      message
    }
  }
`;function Xe(){var R;const z=re(),d=u([]),f=u({}),g=u({orgId:((R=z.currentOrg)==null?void 0:R.id)||"",limit:50,offset:0}),{onResult:V,refetch:S}=ce(Me,g);V(r=>{var p;(p=r.data)!=null&&p.agentJobs&&(d.value=r.data.agentJobs)}),me(()=>{var r;g.value.orgId=((r=z.currentOrg)==null?void 0:r.id)||""});const{onResult:y}=oe(We,()=>({orgId:g.value.orgId}));y(r=>{var q;const p=(q=r.data)==null?void 0:q.jobUpdated;if(p){const D=d.value.findIndex(T=>T.id===p.id);D>=0?d.value.splice(D,1,p):d.value.unshift(p)}});const{mutate:x}=ie(Qe),{mutate:_}=ie(Ge);function c(r){return x({input:r})}function J(r,p){return _({orgId:r,id:p})}function L(r){const{onResult:p}=oe(Ke,{jobId:r});p(q=>{var T;const D=(T=q.data)==null?void 0:T.jobLogAppended;D&&(f.value[r]=f.value[r]||[],f.value[r].push(D))})}return{jobs:d,logs:f,variables:g,refetch:S,enqueueJob:c,cancelJob:J,subscribeJobLogs:L}}const Ye=E`
  query AgentHealth($orgId: ID!) {
    agentHealth(orgId: $orgId) {
      status
      agents
    }
    queues(orgId: $orgId) {
      name
      waiting
      active
      completed
      failed
      delayed
    }
  }
`;function Ze(z){const d=u("unknown"),f=u([]),g=u([]),{onResult:V,refetch:S}=ce(Ye,()=>({orgId:z.value}));return V(y=>{var x,_,c,J,L;d.value=((_=(x=y.data)==null?void 0:x.agentHealth)==null?void 0:_.status)??"unknown",f.value=((J=(c=y.data)==null?void 0:c.agentHealth)==null?void 0:J.agents)??[],g.value=((L=y.data)==null?void 0:L.queues)??[]}),{status:d,agents:f,queues:g,refetch:S}}const he={class:"text-h4"},et={class:"text-h4"},tt={class:"text-h4"},lt={class:"text-h4"},at={class:"d-flex align-center gap-2"},st={class:"flex-grow-1"},nt={class:"text-subtitle-1"},ot={class:"text-body-2 mb-3"},it={class:"text-h6"},ut={class:"text-h6"},dt={class:"text-h6"},rt={key:0,class:"text-caption text-medium-emphasis"},ct={class:"d-flex align-center gap-2"},mt={key:1,class:"text-medium-emphasis"},vt=Ne({__name:"AgentConsole",setup(z){const d=je(),f=u(!1),g=u(!1),V=u(!1),S=u(null),y=u(""),x=u(""),_=u([]),c=u({name:"",description:"",type:""}),J=I(()=>_.value.filter(s=>s.status==="active").length);I(()=>_.value.reduce((s,e)=>s+e.tasksRunning,0));const L=I(()=>{let s=_.value;return y.value&&(s=s.filter(e=>e.name.toLowerCase().includes(y.value.toLowerCase())||e.description.toLowerCase().includes(y.value.toLowerCase()))),x.value&&(s=s.filter(e=>e.status===x.value)),s}),R=[{title:"Active",value:"active"},{title:"Inactive",value:"inactive"},{title:"Error",value:"error"},{title:"Paused",value:"paused"}],r=[{title:"File Processor",value:"file-processor"},{title:"Data Sync",value:"data-sync"},{title:"Notification",value:"notification"},{title:"Backup",value:"backup"},{title:"Analytics",value:"analytics"},{title:"Custom",value:"custom"}];function p(s){switch(s){case"file-processor":return"blue";case"data-sync":return"green";case"notification":return"orange";case"backup":return"purple";case"analytics":return"teal";default:return"grey"}}function q(s){switch(s){case"file-processor":return"mdi-file-cog";case"data-sync":return"mdi-sync";case"notification":return"mdi-bell";case"backup":return"mdi-backup-restore";case"analytics":return"mdi-chart-line";default:return"mdi-robot"}}function D(s){switch(s){case"active":return"success";case"inactive":return"grey";case"error":return"error";case"paused":return"warning";default:return"grey"}}function T(s){return new Date(s).toLocaleString()}async function ve(){V.value=!0;try{await new Promise(e=>setTimeout(e,1e3));const s={id:Date.now().toString(),name:c.value.name,description:c.value.description,type:c.value.type,status:"inactive",tasksCompleted:0,tasksRunning:0,uptime:"0h",created:new Date().toISOString()};_.value.push(s),f.value=!1,c.value={name:"",description:"",type:""},d.add("success","Agent created successfully")}catch{d.add("error","Failed to create agent")}finally{V.value=!1}}function Z(s){d.add("info",`Viewing details for ${s.name}`)}function fe(s){d.add("info",`Editing ${s.name}`)}function pe(s){const e={...s,id:Date.now().toString(),name:`${s.name} (Copy)`,status:"inactive",tasksCompleted:0,tasksRunning:0,uptime:"0h",created:new Date().toISOString()};_.value.push(e),d.add("success","Agent duplicated successfully")}async function _e(s){S.value=s.id;try{await new Promise(e=>setTimeout(e,1500)),s.status==="active"?(s.status="inactive",s.tasksRunning=0,d.add("info",`${s.name} stopped`)):(s.status="active",s.lastActivity=new Date().toISOString(),d.add("success",`${s.name} started`))}catch{d.add("error",`Failed to toggle ${s.name}`)}finally{S.value=null}}function ge(s){const e=_.value.findIndex(v=>v.id===s.id);e>-1&&(_.value.splice(e,1),d.add("info",`${s.name} deleted`))}const ye=re(),H=I(()=>{var s;return((s=ye.currentOrg)==null?void 0:s.id)||""}),{jobs:be,logs:xe,variables:h,enqueueJob:ft,cancelJob:ke,subscribeJobLogs:we}=Xe(),{status:pt,queues:M}=Ze(H),Q=u(null),G=u(null);me(()=>{h.value.status=Q.value||null,h.value.type=G.value||null});const Ce=I(()=>M.value.reduce((s,e)=>s+(e.active||0),0)),Ae=I(()=>M.value.reduce((s,e)=>s+(e.waiting||0),0)),Ie=I(()=>M.value.reduce((s,e)=>s+(e.failed||0),0)),$e=[{title:"queued",value:"queued"},{title:"active",value:"active"},{title:"completed",value:"completed"},{title:"failed",value:"failed"},{title:"delayed",value:"delayed"}],Ve=[{title:"reindexProject",value:"reindexProject"},{title:"reclassifyLowConfidence",value:"reclassifyLowConfidence"},{title:"generateCallSheet",value:"generateCallSheet"},{title:"extractContent",value:"extractContent"},{title:"custom",value:"custom"}],Se=[{title:"ID",key:"id"},{title:"Type",key:"type"},{title:"Target",key:"target"},{title:"Status",key:"status"},{title:"Started",key:"startedAt"},{title:"Duration (ms)",key:"durationMs"},{title:"Actions",key:"actions",sortable:!1}],B=u(!1),W=u(null),ee=u(new Set),te=I(()=>W.value?xe.value[W.value]||[]:[]);function De(s){ee.value.has(s.id)||(we(s.id),ee.value.add(s.id)),W.value=s.id,B.value=!0}async function Je(s){H.value&&await ke(H.value,s.id)}return(s,e)=>{const v=i("v-col"),k=i("v-btn"),U=i("v-row"),b=i("v-icon"),w=i("v-card-text"),C=i("v-card"),le=i("v-text-field"),P=i("v-select"),O=i("v-card-title"),Le=i("v-avatar"),ae=i("v-chip"),j=i("v-list-item-title"),N=i("v-list-item"),qe=i("v-divider"),se=i("v-list"),Te=i("v-menu"),K=i("v-spacer"),X=i("v-card-actions"),Ue=i("v-data-table"),Ee=i("v-list-item-subtitle"),ne=i("v-dialog"),ze=i("v-textarea"),Oe=i("v-form");return $(),F("div",null,[t(U,{class:"mb-4"},{default:l(()=>[t(v,{cols:"12",md:"8"},{default:l(()=>e[13]||(e[13]=[o("h1",{class:"text-h4 font-weight-bold"}," Agent Console ",-1),o("p",{class:"text-subtitle-1 text-medium-emphasis"}," Manage and monitor AI agents and automation workflows ",-1)])),_:1,__:[13]}),t(v,{cols:"12",md:"4",class:"text-right"},{default:l(()=>[t(k,{color:"primary","prepend-icon":"mdi-plus",class:"liquid-button",onClick:e[0]||(e[0]=a=>f.value=!0)},{default:l(()=>e[14]||(e[14]=[n(" Create Agent ",-1)])),_:1,__:[14]})]),_:1})]),_:1}),t(U,{class:"mb-6"},{default:l(()=>[t(v,{cols:"12",md:"3"},{default:l(()=>[t(C,{class:"glass-card"},{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>[t(b,{size:"48",color:"success",class:"mb-2"},{default:l(()=>e[15]||(e[15]=[n(" mdi-robot ",-1)])),_:1,__:[15]}),o("div",he,m(J.value),1),e[16]||(e[16]=o("div",{class:"text-subtitle-2 text-medium-emphasis"}," Active Agents ",-1))]),_:1,__:[16]})]),_:1})]),_:1}),t(v,{cols:"12",md:"3"},{default:l(()=>[t(C,{class:"glass-card"},{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>[t(b,{size:"48",color:"primary",class:"mb-2"},{default:l(()=>e[17]||(e[17]=[n(" mdi-play ",-1)])),_:1,__:[17]}),o("div",et,m(Ce.value),1),e[18]||(e[18]=o("div",{class:"text-subtitle-2 text-medium-emphasis"}," Running Tasks ",-1))]),_:1,__:[18]})]),_:1})]),_:1}),t(v,{cols:"12",md:"3"},{default:l(()=>[t(C,null,{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>[t(b,{size:"48",color:"warning",class:"mb-2"},{default:l(()=>e[19]||(e[19]=[n(" mdi-clock ",-1)])),_:1,__:[19]}),o("div",tt,m(Ae.value),1),e[20]||(e[20]=o("div",{class:"text-subtitle-2 text-medium-emphasis"}," Queued Tasks ",-1))]),_:1,__:[20]})]),_:1})]),_:1}),t(v,{cols:"12",md:"3"},{default:l(()=>[t(C,null,{default:l(()=>[t(w,{class:"text-center"},{default:l(()=>[t(b,{size:"48",color:"error",class:"mb-2"},{default:l(()=>e[21]||(e[21]=[n(" mdi-alert ",-1)])),_:1,__:[21]}),o("div",lt,m(Ie.value),1),e[22]||(e[22]=o("div",{class:"text-subtitle-2 text-medium-emphasis"}," Failed Tasks ",-1))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1}),t(U,null,{default:l(()=>[t(v,{cols:"12"},{default:l(()=>[t(C,null,{default:l(()=>[t(O,{class:"d-flex align-center justify-space-between"},{default:l(()=>[o("div",null,[t(b,{class:"mr-2"},{default:l(()=>e[23]||(e[23]=[n(" mdi-robot ",-1)])),_:1,__:[23]}),e[24]||(e[24]=n(" AI Agents ",-1))]),o("div",at,[t(le,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),"prepend-inner-icon":"mdi-magnify",label:"Search agents...",variant:"outlined",density:"compact","hide-details":"",clearable:"",style:{width:"250px"}},null,8,["modelValue"]),t(P,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=a=>x.value=a),items:R,label:"Filter by status",variant:"outlined",density:"compact","hide-details":"",clearable:"",style:{width:"150px"}},null,8,["modelValue"])])]),_:1}),t(w,null,{default:l(()=>[t(U,null,{default:l(()=>[($(!0),F(ue,null,de(L.value,a=>($(),Y(v,{key:a.id,cols:"12",md:"6",lg:"4"},{default:l(()=>[t(C,{class:Re(["agent-card",{active:a.status==="active"}]),variant:"outlined"},{default:l(()=>[t(O,{class:"d-flex align-center"},{default:l(()=>[t(Le,{color:p(a.type),class:"mr-3",size:"40"},{default:l(()=>[t(b,{icon:q(a.type)},null,8,["icon"])]),_:2},1032,["color"]),o("div",st,[o("div",nt,m(a.name),1),t(ae,{color:D(a.status),size:"x-small",variant:"tonal"},{default:l(()=>[n(m(a.status),1)]),_:2},1032,["color"])]),t(Te,null,{activator:l(({props:A})=>[t(k,Be({ref_for:!0},A,{icon:"mdi-dots-vertical",variant:"text",size:"small"}),null,16)]),default:l(()=>[t(se,null,{default:l(()=>[t(N,{onClick:A=>Z(a)},{default:l(()=>[t(j,null,{default:l(()=>[t(b,{start:""},{default:l(()=>e[25]||(e[25]=[n(" mdi-eye ",-1)])),_:1,__:[25]}),e[26]||(e[26]=n(" View Details ",-1))]),_:1,__:[26]})]),_:2},1032,["onClick"]),t(N,{onClick:A=>fe(a)},{default:l(()=>[t(j,null,{default:l(()=>[t(b,{start:""},{default:l(()=>e[27]||(e[27]=[n(" mdi-pencil ",-1)])),_:1,__:[27]}),e[28]||(e[28]=n(" Edit ",-1))]),_:1,__:[28]})]),_:2},1032,["onClick"]),t(N,{onClick:A=>pe(a)},{default:l(()=>[t(j,null,{default:l(()=>[t(b,{start:""},{default:l(()=>e[29]||(e[29]=[n(" mdi-content-copy ",-1)])),_:1,__:[29]}),e[30]||(e[30]=n(" Duplicate ",-1))]),_:1,__:[30]})]),_:2},1032,["onClick"]),t(qe),t(N,{class:"text-error",onClick:A=>ge(a)},{default:l(()=>[t(j,null,{default:l(()=>[t(b,{start:""},{default:l(()=>e[31]||(e[31]=[n(" mdi-delete ",-1)])),_:1,__:[31]}),e[32]||(e[32]=n(" Delete ",-1))]),_:1,__:[32]})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(w,null,{default:l(()=>[o("p",ot,m(a.description),1),t(U,{class:"text-center mb-3"},{default:l(()=>[t(v,{cols:"4"},{default:l(()=>[o("div",it,m(a.tasksCompleted),1),e[33]||(e[33]=o("div",{class:"text-caption text-medium-emphasis"}," Completed ",-1))]),_:2,__:[33]},1024),t(v,{cols:"4"},{default:l(()=>[o("div",ut,m(a.tasksRunning),1),e[34]||(e[34]=o("div",{class:"text-caption text-medium-emphasis"}," Running ",-1))]),_:2,__:[34]},1024),t(v,{cols:"4"},{default:l(()=>[o("div",dt,m(a.uptime),1),e[35]||(e[35]=o("div",{class:"text-caption text-medium-emphasis"}," Uptime ",-1))]),_:2,__:[35]},1024)]),_:2},1024),a.lastActivity?($(),F("div",rt," Last activity: "+m(T(a.lastActivity)),1)):Pe("",!0)]),_:2},1024),t(X,null,{default:l(()=>[t(k,{color:a.status==="active"?"warning":"success",variant:"outlined",size:"small",loading:S.value===a.id,onClick:A=>_e(a)},{default:l(()=>[n(m(a.status==="active"?"Stop":"Start"),1)]),_:2},1032,["color","loading","onClick"]),t(K),t(k,{color:"primary",variant:"flat",size:"small",onClick:A=>Z(a)},{default:l(()=>e[36]||(e[36]=[n(" View Details ",-1)])),_:2,__:[36]},1032,["onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(U,{class:"mt-6"},{default:l(()=>[t(v,{cols:"12"},{default:l(()=>[t(C,{class:"glass-card"},{default:l(()=>[t(O,{class:"d-flex align-center justify-space-between"},{default:l(()=>[o("div",null,[t(b,{class:"mr-2"},{default:l(()=>e[37]||(e[37]=[n(" mdi-format-list-bulleted ",-1)])),_:1,__:[37]}),e[38]||(e[38]=n(" Jobs ",-1))]),o("div",ct,[t(P,{modelValue:Q.value,"onUpdate:modelValue":e[3]||(e[3]=a=>Q.value=a),items:$e,label:"Status",variant:"outlined",density:"compact","hide-details":"",clearable:"",style:{width:"160px"}},null,8,["modelValue"]),t(P,{modelValue:G.value,"onUpdate:modelValue":e[4]||(e[4]=a=>G.value=a),items:Ve,label:"Type",variant:"outlined",density:"compact","hide-details":"",clearable:"",style:{width:"200px"}},null,8,["modelValue"])])]),_:1}),t(w,null,{default:l(()=>[t(Ue,{headers:Se,items:Fe(be),"item-key":"id",density:"comfortable"},{"item.actions":l(({item:a})=>[t(k,{size:"x-small",color:"primary",variant:"tonal",onClick:A=>De(a)},{default:l(()=>e[39]||(e[39]=[n(" Logs ",-1)])),_:2,__:[39]},1032,["onClick"]),t(k,{size:"x-small",color:"error",variant:"text",class:"ml-2",onClick:A=>Je(a)},{default:l(()=>e[40]||(e[40]=[n(" Cancel ",-1)])),_:2,__:[40]},1032,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1})]),_:1}),t(ne,{modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=a=>B.value=a),"max-width":"900"},{default:l(()=>[t(C,{class:"glass-card"},{default:l(()=>[t(O,null,{default:l(()=>e[41]||(e[41]=[n("Job Logs",-1)])),_:1,__:[41]}),t(w,{style:{"max-height":"60vh",overflow:"auto"}},{default:l(()=>[te.value.length?($(),Y(se,{key:0},{default:l(()=>[($(!0),F(ue,null,de(te.value,a=>($(),Y(N,{key:a.timestamp+a.message},{default:l(()=>[t(j,null,{default:l(()=>[o("strong",null,m(new Date(a.timestamp).toLocaleString()),1),t(ae,{color:a.level==="error"?"error":a.level==="warn"?"warning":"info",size:"x-small",class:"ml-2",variant:"tonal"},{default:l(()=>[n(m(a.level),1)]),_:2},1032,["color"])]),_:2},1024),t(Ee,{class:"mt-1"},{default:l(()=>[n(m(a.message),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):($(),F("div",mt," No logs yet. "))]),_:1}),t(X,null,{default:l(()=>[t(K),t(k,{variant:"text",onClick:e[5]||(e[5]=a=>B.value=!1)},{default:l(()=>e[42]||(e[42]=[n(" Close ",-1)])),_:1,__:[42]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ne,{modelValue:f.value,"onUpdate:modelValue":e[12]||(e[12]=a=>f.value=a),"max-width":"600"},{default:l(()=>[t(C,{class:"glass-card"},{default:l(()=>[t(O,null,{default:l(()=>e[43]||(e[43]=[n("Create New Agent",-1)])),_:1,__:[43]}),t(w,null,{default:l(()=>[t(Oe,{ref:"createForm",modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=a=>g.value=a)},{default:l(()=>[t(le,{modelValue:c.value.name,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value.name=a),label:"Agent Name","prepend-icon":"mdi-robot",rules:[a=>!!a||"Name is required"],required:""},null,8,["modelValue","rules"]),t(ze,{modelValue:c.value.description,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value.description=a),label:"Description","prepend-icon":"mdi-text",rows:"3"},null,8,["modelValue"]),t(P,{modelValue:c.value.type,"onUpdate:modelValue":e[9]||(e[9]=a=>c.value.type=a),items:r,label:"Agent Type","prepend-icon":"mdi-format-list-bulleted-type",rules:[a=>!!a||"Type is required"],required:""},null,8,["modelValue","rules"])]),_:1},8,["modelValue"])]),_:1}),t(X,null,{default:l(()=>[t(K),t(k,{variant:"text",onClick:e[11]||(e[11]=a=>f.value=!1)},{default:l(()=>e[44]||(e[44]=[n(" Cancel ",-1)])),_:1,__:[44]}),t(k,{color:"primary",disabled:!g.value,loading:V.value,onClick:ve},{default:l(()=>e[45]||(e[45]=[n(" Create Agent ",-1)])),_:1,__:[45]},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const kt=He(vt,[["__scopeId","data-v-edc27416"]]);export{kt as default};
