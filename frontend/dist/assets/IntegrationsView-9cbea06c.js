import{r as b,c as j,v as x,a7 as p,a8 as n,a4 as l,a6 as v,A as a,E as y,_ as u,u as c,W as w,ab as U,ad as E,D as ee,ac as Q,F as M,w as L,ai as le,a as W}from"./vue-3f691d55.js";import{c as Y,l as te,u as se}from"./apollo-30a378f4.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";const R=b(!1),B=b(!1),N=b(!1),V=b(null),h=b(null),J=b([]),z=b([]),Z=b(""),S=b(!1),G=b({type:"",name:"",config:{enableWebhooks:!1}}),q=j({get:()=>{var o;return((o=V.value)==null?void 0:o.rootFolder)||""},set:o=>{V.value&&(V.value.rootFolder=o)}}),H=j({get:()=>{var o,e;return((e=(o=V.value)==null?void 0:o.config)==null?void 0:e.enableWebhooks)||!1},set:o=>{V.value&&(V.value.config||(V.value.config={}),V.value.config.enableWebhooks=o)}}),K=b([{id:"dropbox",type:"dropbox",name:"Dropbox",description:"Connect your Dropbox account to sync files",icon:"mdi-dropbox",color:"#0061ff"},{id:"googledrive",type:"googledrive",name:"Google Drive",description:"Connect your Google Drive account to sync files",icon:"mdi-google-drive",color:"#4285f4"},{id:"onedrive",type:"onedrive",name:"OneDrive",description:"Connect your OneDrive account to sync files",icon:"mdi-microsoft-onedrive",color:"#0078d4"}]),ie=j(()=>{if(!Z.value)return z.value;const o=Z.value.toLowerCase();return z.value.filter(e=>e.name.toLowerCase().includes(o)||e.description&&e.description.toLowerCase().includes(o)||e.type.toLowerCase().includes(o))});function re(o){o!=null&&o.getSources&&(z.value=o.getSources.map(e=>{var t,r;return{id:e.id,type:e.type==="google_drive"?"googledrive":e.type,name:e.name,description:e.type==="dropbox"?"Dropbox storage":e.type==="google_drive"?"Google Drive storage":e.type,connected:e.active,lastSync:e.updatedAt,rootFolder:(t=e.config)==null?void 0:t.rootFolder,webhookStatus:(r=e.config)!=null&&r.enableWebhooks?"active":"inactive",stats:void 0,__existing:!0,active:e.active,updatedAt:e.updatedAt,config:e.config}}))}const de=Y`
  query GetSources($organizationId: ID!) {
    getSources(organizationId: $organizationId) {
      id
      type
      name
      active
      updatedAt
      config
    }
  }
`,ce=Y`
  mutation CreateSource($input: CreateSourceInput!) {
    createSource(input: $input) {
      id
      type
      name
      active
      updatedAt
      config
    }
  }
`,ue=Y`
  mutation TriggerSync($input: TriggerSyncInput!) {
    triggerSync(input: $input) {
      success
      message
    }
  }
`,_e=o=>se(de,()=>({organizationId:o}),()=>({enabled:!!o,fetchPolicy:"cache-and-network"})),{mutate:ve}=te(ce);te(ue);function ge(o){const e=K.value.find(t=>t.type===o);return e?e.color:"#666"}function pe(o){const e=K.value.find(t=>t.type===o);return e?e.icon:"mdi-help"}function me(o){switch(o){case"error":return"error";case"warn":return"warning";case"warning":return"warning";case"success":return"success";case"info":return"info";default:return"default"}}function fe(o){return new Date(o).toLocaleDateString()}function ye(o){return new Date(o).toLocaleString()}function oe(o,e){console.log(`[${o.toUpperCase()}] ${e}`)}function P(o){oe("error",o)}function X(o){oe("success",o)}const O="http://localhost:8080/api";async function ne(o){var e,t;try{S.value=!0;const r=o.type,_="12345";if(o.__existing&&o.id){window.location.href=`${O}/oauth/${r}?organizationId=${encodeURIComponent(_)}&sourceId=${encodeURIComponent(o.id)}`;return}const d=await ve({input:{organizationId:_,type:r==="googledrive"?"google_drive":r,name:o.name||`${r} Integration`,config:{}}}),i=(t=(e=d==null?void 0:d.data)==null?void 0:e.createSource)==null?void 0:t.id;if(!i)throw new Error("Failed to create source before OAuth");window.location.href=`${O}/oauth/${r}?organizationId=${encodeURIComponent(_)}&sourceId=${encodeURIComponent(i)}`}catch(r){P(`Failed to connect ${o.name}: ${r}`)}finally{S.value=!1}}async function Ie(o){try{if(S.value=!0,!(await fetch(`${O}/sources/${o.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to disconnect integration");z.value=z.value.filter(t=>t.id!==o.id),X(`${o.name} disconnected successfully`)}catch(e){P(`Failed to disconnect ${o.name}: ${e}`)}finally{S.value=!1}}async function we(o){try{if(S.value=!0,!(await fetch(`${O}/sources/${o.id}/sync`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to trigger sync");X(`Sync started for ${o.name}`);const t=z.value.find(r=>r.id===o.id);t&&(t.lastSync=new Date().toISOString())}catch(e){P(`Failed to trigger sync for ${o.name}: ${e}`)}finally{S.value=!1}}function be(o){V.value=o,B.value=!0}async function $e(o){try{h.value=o,S.value=!0;const e=await fetch(`${O}/sources/${o.id}/logs`);if(!e.ok)throw new Error("Failed to fetch logs");const t=await e.json();J.value=t.map(r=>({id:r.id,timestamp:r.timestamp,level:r.level,message:r.message})),N.value=!0}catch(e){P(`Failed to fetch logs for ${o.name}: ${e}`)}finally{S.value=!1}}function Ce(o){G.value={type:o.type,name:`${o.name} Integration`,config:{}},R.value=!0}function ke(){R.value=!1,G.value.type&&ne({id:"",type:G.value.type,name:G.value.name,connected:!1})}async function Ve(){try{S.value=!0,X("Configuration saved successfully"),ae()}catch(o){P(`Failed to save configuration: ${o}`)}finally{S.value=!1}}function ae(){B.value=!1,V.value=null}function Se(){N.value=!1,h.value=null,J.value=[]}const De=x({__name:"IntegrationsHeader",emits:["add-integration"],setup(o){return(e,t)=>{const r=l("v-col"),_=l("v-btn"),d=l("v-row");return v(),p(d,{class:"mb-4"},{default:n(()=>[a(r,{cols:"12",md:"8"},{default:n(()=>t[1]||(t[1]=[y("h1",{class:"text-h4 font-weight-bold"}," Integrations ",-1),y("p",{class:"text-subtitle-1 text-medium-emphasis"}," Connect and manage external services for your project ",-1)])),_:1,__:[1]}),a(r,{cols:"12",md:"4",class:"text-right"},{default:n(()=>[a(_,{color:"primary","prepend-icon":"mdi-plus",class:"liquid-button",onClick:t[0]||(t[0]=i=>e.$emit("add-integration"))},{default:n(()=>t[2]||(t[2]=[u(" Add Integration ",-1)])),_:1,__:[2]})]),_:1})]),_:1})}}});const Fe=T(De,[["__scopeId","data-v-d282c3ad"]]),Ae={class:"text-h6"},Le={key:0,class:"mb-3"},Ee={key:1,class:"integration-stats"},Re={class:"stat-card"},xe={class:"stat-value"},Ue={class:"stat-card"},ze={class:"stat-value"},Te={class:"stat-card"},We={class:"stat-value"},Be=x({__name:"IntegrationCard",props:{integration:{},loading:{type:Boolean}},emits:["connect","sync","configure","view-logs","disconnect"],setup(o){return(e,t)=>{const r=l("v-icon"),_=l("v-avatar"),d=l("v-chip"),i=l("v-card-title"),s=l("v-list-item-title"),$=l("v-list-item-subtitle"),C=l("v-list-item"),g=l("v-list"),D=l("v-card-text"),I=l("v-btn"),F=l("v-card-actions"),A=l("v-card");return v(),p(A,{class:ee(["integration-card glass-card",{connected:e.integration.connected}])},{default:n(()=>[a(i,{class:"d-flex align-center"},{default:n(()=>[a(_,{color:c(ge)(e.integration.type),class:"mr-3",size:"40"},{default:n(()=>[a(r,{icon:c(pe)(e.integration.type)},null,8,["icon"])]),_:1},8,["color"]),y("div",null,[y("div",Ae,w(e.integration.name),1),a(d,{color:e.integration.connected?"success":"warning",size:"small",variant:"tonal"},{default:n(()=>[u(w(e.integration.connected?"Connected":"Disconnected"),1)]),_:1},8,["color"])])]),_:1}),a(D,null,{default:n(()=>[e.integration.connected?(v(),U("div",Le,[a(g,{density:"compact"},{default:n(()=>[e.integration.lastSync?(v(),p(C,{key:0},{default:n(()=>[a(s,null,{default:n(()=>t[5]||(t[5]=[u("Last Sync",-1)])),_:1,__:[5]}),a($,null,{default:n(()=>[u(w(c(fe)(e.integration.lastSync)),1)]),_:1})]),_:1})):E("",!0),e.integration.rootFolder?(v(),p(C,{key:1},{default:n(()=>[a(s,null,{default:n(()=>t[6]||(t[6]=[u("Root Folder",-1)])),_:1,__:[6]}),a($,null,{default:n(()=>[u(w(e.integration.rootFolder),1)]),_:1})]),_:1})):E("",!0),e.integration.webhookStatus?(v(),p(C,{key:2},{default:n(()=>[a(s,null,{default:n(()=>t[7]||(t[7]=[u("Webhook Status",-1)])),_:1,__:[7]}),a($,null,{default:n(()=>[a(d,{color:e.integration.webhookStatus==="active"?"success":"warning",size:"x-small"},{default:n(()=>[u(w(e.integration.webhookStatus),1)]),_:1},8,["color"])]),_:1})]),_:1})):E("",!0)]),_:1})])):E("",!0),e.integration.stats?(v(),U("div",Ee,[y("div",Re,[y("div",xe,w(e.integration.stats.files),1),t[8]||(t[8]=y("div",{class:"stat-label"}," Files ",-1))]),y("div",Ue,[y("div",ze,w(e.integration.stats.folders),1),t[9]||(t[9]=y("div",{class:"stat-label"}," Folders ",-1))]),y("div",Te,[y("div",We,w(e.integration.stats.size),1),t[10]||(t[10]=y("div",{class:"stat-label"}," Size ",-1))])])):E("",!0)]),_:1}),a(F,null,{default:n(()=>[e.integration.connected?(v(),p(I,{key:1,color:"success",variant:"outlined",loading:e.loading,onClick:t[1]||(t[1]=m=>e.$emit("sync",e.integration))},{default:n(()=>t[12]||(t[12]=[u(" Sync Now ",-1)])),_:1,__:[12]},8,["loading"])):(v(),p(I,{key:0,color:"primary",variant:"flat",loading:e.loading,onClick:t[0]||(t[0]=m=>e.$emit("connect",e.integration))},{default:n(()=>t[11]||(t[11]=[u(" Connect ",-1)])),_:1,__:[11]},8,["loading"])),e.integration.connected?(v(),p(I,{key:2,variant:"text",onClick:t[2]||(t[2]=m=>e.$emit("configure",e.integration))},{default:n(()=>t[13]||(t[13]=[u(" Configure ",-1)])),_:1,__:[13]})):E("",!0),e.integration.connected?(v(),p(I,{key:3,variant:"text",onClick:t[3]||(t[3]=m=>e.$emit("view-logs",e.integration))},{default:n(()=>t[14]||(t[14]=[u(" Logs ",-1)])),_:1,__:[14]})):E("",!0),e.integration.connected?(v(),p(I,{key:4,variant:"text",color:"error",onClick:t[4]||(t[4]=m=>e.$emit("disconnect",e.integration))},{default:n(()=>t[15]||(t[15]=[u(" Disconnect ",-1)])),_:1,__:[15]})):E("",!0)]),_:1})]),_:1},8,["class"])}}});const Ne=T(Be,[["__scopeId","data-v-10f4c0fa"]]),Ge=x({__name:"AvailableIntegrations",props:{availableIntegrations:{}},emits:["add"],setup(o){return(e,t)=>{const r=l("v-card-title"),_=l("v-icon"),d=l("v-avatar"),i=l("v-list-item-title"),s=l("v-list-item-subtitle"),$=l("v-btn"),C=l("v-list-item"),g=l("v-list"),D=l("v-col"),I=l("v-row"),F=l("v-card-text"),A=l("v-card");return v(),p(A,{class:"mt-6 glass-card"},{default:n(()=>[a(r,null,{default:n(()=>t[0]||(t[0]=[u(" Available Integrations ",-1)])),_:1,__:[0]}),a(F,null,{default:n(()=>[a(I,null,{default:n(()=>[(v(!0),U(M,null,Q(e.availableIntegrations,m=>(v(),p(D,{key:m.id,cols:"12",md:"6",lg:"4"},{default:n(()=>[a(g,null,{default:n(()=>[a(C,null,{prepend:n(()=>[a(d,{color:m.color,size:"40"},{default:n(()=>[a(_,{icon:m.icon},null,8,["icon"])]),_:2},1032,["color"])]),append:n(()=>[a($,{color:"primary",variant:"outlined",size:"small",onClick:f=>e.$emit("add",m)},{default:n(()=>t[2]||(t[2]=[u(" Add ",-1)])),_:2,__:[2]},1032,["onClick"])]),default:n(()=>[a(i,null,{default:n(()=>[u(w(m.name),1)]),_:2},1024),m.description?(v(),p(s,{key:0},{default:n(()=>[u(w(m.description),1)]),_:2},1024)):(v(),p(s,{key:1},{default:n(()=>t[1]||(t[1]=[u("No description available",-1)])),_:1,__:[1]}))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}});const Oe=T(Ge,[["__scopeId","data-v-c7a5dd7a"]]),Pe=x({__name:"AddIntegrationDialog",props:{modelValue:{type:Boolean},newIntegration:{}},emits:["update:modelValue","update:newIntegration","cancel","proceed"],setup(o,{emit:e}){const t=o,r=e,_=b(t.modelValue),d=b({...t.newIntegration});return L(()=>t.modelValue,i=>{_.value=i}),L(_,i=>{r("update:modelValue",i)}),L(()=>t.newIntegration,()=>{d.value={...t.newIntegration}}),(i,s)=>{const $=l("v-card-title"),C=l("v-text-field"),g=l("v-card-text"),D=l("v-spacer"),I=l("v-btn"),F=l("v-card-actions"),A=l("v-card"),m=l("v-dialog");return v(),p(m,{modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=f=>_.value=f),"max-width":"500px"},{default:n(()=>[a(A,{class:"glass-card"},{default:n(()=>[a($,null,{default:n(()=>s[4]||(s[4]=[u(" Add New Integration ",-1)])),_:1,__:[4]}),a(g,null,{default:n(()=>[a(C,{modelValue:d.value.name,"onUpdate:modelValue":s[0]||(s[0]=f=>d.value.name=f),label:"Integration Name",required:""},null,8,["modelValue"])]),_:1}),a(F,null,{default:n(()=>[a(D),a(I,{color:"error",variant:"text",onClick:s[1]||(s[1]=f=>i.$emit("cancel"))},{default:n(()=>s[5]||(s[5]=[u(" Cancel ",-1)])),_:1,__:[5]}),a(I,{color:"primary",variant:"flat",onClick:s[2]||(s[2]=f=>i.$emit("proceed"))},{default:n(()=>s[6]||(s[6]=[u(" Continue ",-1)])),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const je=T(Pe,[["__scopeId","data-v-91067c06"]]),qe=x({__name:"ConfigureIntegrationDialog",props:{modelValue:{type:Boolean},selectedIntegration:{},selectedIntegrationRootFolder:{},selectedIntegrationEnableWebhooks:{type:Boolean}},emits:["update:modelValue","update:selectedIntegrationRootFolder","update:selectedIntegrationEnableWebhooks","close","save"],setup(o,{emit:e}){const t=o,r=e,_=b(t.modelValue),d=j({get:()=>t.selectedIntegrationRootFolder,set:i=>r("update:selectedIntegrationRootFolder",i)});return L(()=>t.modelValue,i=>{_.value=i}),L(_,i=>{r("update:modelValue",i)}),(i,s)=>{const $=l("v-card-title"),C=l("v-text-field"),g=l("v-card-text"),D=l("v-spacer"),I=l("v-btn"),F=l("v-card-actions"),A=l("v-card"),m=l("v-dialog");return v(),p(m,{modelValue:_.value,"onUpdate:modelValue":s[3]||(s[3]=f=>_.value=f),"max-width":"600px"},{default:n(()=>[a(A,{class:"glass-card"},{default:n(()=>[a($,null,{default:n(()=>{var f;return[u(" Configure "+w((f=i.selectedIntegration)==null?void 0:f.name),1)]}),_:1}),a(g,null,{default:n(()=>[a(C,{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=f=>d.value=f),label:"Root Folder Path"},null,8,["modelValue"])]),_:1}),a(F,null,{default:n(()=>[a(D),a(I,{color:"error",variant:"text",onClick:s[1]||(s[1]=f=>i.$emit("close"))},{default:n(()=>s[4]||(s[4]=[u(" Cancel ",-1)])),_:1,__:[4]}),a(I,{color:"primary",variant:"flat",onClick:s[2]||(s[2]=f=>i.$emit("save"))},{default:n(()=>s[5]||(s[5]=[u(" Save ",-1)])),_:1,__:[5]})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const He=T(qe,[["__scopeId","data-v-2b4bc382"]]),Qe={class:"d-flex align-start"},Me={class:"log-timestamp"},Ye={class:"log-message"},he=x({__name:"LogsDialog",props:{modelValue:{type:Boolean},logsIntegration:{},logs:{}},emits:["update:modelValue","close"],setup(o,{emit:e}){const t=o,r=e,_=b(t.modelValue);return L(()=>t.modelValue,d=>{_.value=d}),L(_,d=>{r("update:modelValue",d)}),(d,i)=>{const s=l("v-card-title"),$=l("v-chip"),C=l("v-list-item"),g=l("v-list"),D=l("v-card-text"),I=l("v-spacer"),F=l("v-btn"),A=l("v-card-actions"),m=l("v-card"),f=l("v-dialog");return v(),p(f,{modelValue:_.value,"onUpdate:modelValue":i[1]||(i[1]=k=>_.value=k),"max-width":"800px"},{default:n(()=>[a(m,{class:"glass-card"},{default:n(()=>[a(s,null,{default:n(()=>{var k;return[u(" Integration Logs - "+w((k=d.logsIntegration)==null?void 0:k.name),1)]}),_:1}),a(D,null,{default:n(()=>[a(g,null,{default:n(()=>[(v(!0),U(M,null,Q(d.logs,k=>(v(),p(C,{key:k.id,class:ee(["log-entry",`log-${k.level}`])},{default:n(()=>[y("div",Qe,[y("div",Me,w(c(ye)(k.timestamp)),1),a($,{color:c(me)(k.level),size:"x-small",class:"log-level mr-2 mt-1"},{default:n(()=>[u(w(k.level),1)]),_:2},1032,["color"]),y("div",Ye,w(k.message),1)])]),_:2},1032,["class"]))),128))]),_:1})]),_:1}),a(A,null,{default:n(()=>[a(I),a(F,{color:"primary",variant:"flat",onClick:i[0]||(i[0]=k=>d.$emit("close"))},{default:n(()=>i[2]||(i[2]=[u(" Close ",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});const Je=T(he,[["__scopeId","data-v-67897675"]]),et=x({__name:"IntegrationsView",setup(o){const t=le().params.id,{result:r,loading:_,error:d}=_e(t);return L(r,i=>{re(i)}),L(d,i=>{i&&console.error("GraphQL Error:",i)}),(i,s)=>{const $=l("v-col"),C=l("v-row");return v(),U("div",null,[a(Fe,{onAddIntegration:s[0]||(s[0]=g=>R.value=!0)}),a(C,null,{default:n(()=>[(v(!0),U(M,null,Q(c(ie),g=>(v(),p($,{key:g.id,cols:"12",md:"6",lg:"4"},{default:n(()=>[a(Ne,{integration:g,loading:c(S),onConnect:c(ne),onSync:c(we),onConfigure:c(be),onViewLogs:c($e),onDisconnect:c(Ie)},null,8,["integration","loading","onConnect","onSync","onConfigure","onViewLogs","onDisconnect"])]),_:2},1024))),128))]),_:1}),a(Oe,{"available-integrations":c(K),onAdd:c(Ce)},null,8,["available-integrations","onAdd"]),a(je,{modelValue:c(R),"onUpdate:modelValue":s[1]||(s[1]=g=>W(R)?R.value=g:null),"new-integration":c(G),onCancel:s[2]||(s[2]=g=>R.value=!1),onProceed:c(ke)},null,8,["modelValue","new-integration","onProceed"]),a(He,{modelValue:c(B),"onUpdate:modelValue":s[3]||(s[3]=g=>W(B)?B.value=g:null),"selected-integration-root-folder":c(q),"onUpdate:selectedIntegrationRootFolder":s[4]||(s[4]=g=>W(q)?q.value=g:null),"selected-integration-enable-webhooks":c(H),"onUpdate:selectedIntegrationEnableWebhooks":s[5]||(s[5]=g=>W(H)?H.value=g:null),"selected-integration":c(V),onClose:c(ae),onSave:c(Ve)},null,8,["modelValue","selected-integration-root-folder","selected-integration-enable-webhooks","selected-integration","onClose","onSave"]),a(Je,{modelValue:c(N),"onUpdate:modelValue":s[6]||(s[6]=g=>W(N)?N.value=g:null),"logs-integration":c(h),logs:c(J),onClose:c(Se)},null,8,["modelValue","logs-integration","logs","onClose"])])}}});export{et as default};
