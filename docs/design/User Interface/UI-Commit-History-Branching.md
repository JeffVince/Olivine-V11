# Commit History & Branching (Ops Ledger and Version Control)

* [ ] **Commit History & Branching (Ops Ledger and Version Control):** Provides transparency into all changes and the ability to manage changes via branches or undo operations.

  * [ ] **Activity Log (Ops Ledger):** Present a chronological log of significant events and actions in the project. This can be a tab in the project or a dedicated "Activity" view. Each entry should include timestamp, event description, and actor (which could be a user or an AI agent).

    * [ ] Display different types of events such as file operations (renames, moves, deletions), suggestions issued, suggestions approved/rejected, call sheet creations, policy changes, integration events, etc. For example: "File Renamed: 'Scene5\_shotA.mp4' → 'Scene5\_CamA\_Take1.mp4' (Approved by John)", or "Suggestion: Rename 'Scene5\_shotA.mp4'… (File Steward) – Awaiting approval", or "Project Created and Dropbox folder linked." Use clear language for each.
    * [ ] **Color-coding / Icons:** Use icons or colors to distinguish event types at a glance (e.g. green checkmark for completed approvals, yellow info for suggestions pending, red for errors or deletions).
    * [ ] **Filtering & Search:** Allow filtering the log by event type or actor. For instance, filter to only "File Changes" or only "Call Sheets" or only "Errors", and/or filter by agent vs user actions. Include a search bar to find specific entries (by filename, user name, etc.). This helps users quickly locate relevant history (e.g. "when was this file last changed?").
    * [ ] **Integrity & Detail:** Ensure log entries are read-only and cannot be altered (append-only history). The UI should not allow deletion or editing of log entries, even by admins, to preserve a trustworthy audit trail. If needed, an admin could add a clarifying note as a new entry, but never remove history. Communicate this immutability in the UI (e.g. a note "All actions are logged and cannot be changed" to build trust).
    * [ ] **Contextual Drill-down:** If a log entry refers to an object (like a specific file or call sheet), make it clickable or provide a quick way to view that item (e.g. click a file name in the log to highlight it in File Explorer or open its inspector; click a call sheet entry to open that call sheet).
  * [ ] **Branch Management:** (Phase 2) Support a workflow where users can create "branches" of project state for sandboxing changes.

    * [ ] **Branch Creation:** Provide an option to create a new branch from the current state (for example, a "Create Branch" button in the UI, perhaps on the project dashboard or activity log section). The user can name the branch (defaulting to something like "Draft" or "Experiment"). This will fork the project's state or at least the ledger context so that subsequent suggestions/approvals go into that branch without affecting the main.
    * [ ] **Branch Indicator & Switch:** Clearly show the active branch name in the UI (e.g. a dropdown in the header or a tag in the project view saying "Branch: Main" or "Branch: Experiment A"). Allow the user to switch between branches (which changes the data being viewed in File Explorer, etc., to that branch's state). Warn if switching branch while there are uncommitted changes in the UI.
    * [ ] **Isolated Changes:** In a branch, users can approve suggestions or make changes without altering the main branch. The Approvals and file views should reflect branch-specific pending items and commits. Perhaps color-code or label things to remind the user they are in a branch context.
    * [ ] **Merging Branches:** Provide a UI to merge a branch back into main (or another branch). For example, a "Merge Changes" action that will take all commits from the branch and apply them to main in one go. Show a summary of changes that will be merged (like a list of file ops) for confirmation. After merge, update the main branch's state and ledger (log a merge event summarizing it), and either retain the branch (as historical) or allow it to be deleted.
    * [ ] **Branch Diff/Review:** Before merging, or at any time, allow users to compare branches – e.g. see what commits or differences exist between the branch and main. This could be a list of pending commit entries or a high-level diff (like "Branch has 5 renames and 2 new files that are not in Main"). This helps in reviewing branch changes before approval.
    * [ ] **Revert Commits:** In the ledger view, for each action that was applied, allow an "Undo" or "Revert" action when appropriate. Clicking revert should create a new suggestion or direct action to reverse that change (e.g. if a file was renamed, a revert would suggest renaming it back to the old name; if a file was deleted, perhaps suggest restoring it from backup if possible). The revert action itself should be logged as a new entry (e.g. "User X reverted the rename of Y").
    * [ ] If a suggestion was rejected or auto-withdrawn, and the user changes their mind, provide a way to revisit it (perhaps via re-triggering the agent or pulling it from the log to new suggestion). This might be done via a "resubmit" action on the log entry.
    * [ ] **Multi-User Branch Visibility:** If branches are used, ensure that all team members with access can see and switch to the branches (unless branch permissions are a feature). Indicate who created a branch and when, for context. Possibly show active branches in the project dashboard for awareness.
